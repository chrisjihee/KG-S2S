(KG-S2S) chrisjihee@ptlm3:~/proj/KG-S2S$ export CUDA_VISIBLE_DEVICES=3
(KG-S2S) chrisjihee@ptlm3:~/proj/KG-S2S$ setting-korean/train-FB15k-237N-ko-KeByT5-2.sh
Namespace(dataset_path='./data/processed', dataset='FB15k-237N-ko', model='T5Finetuner', precision='32', accelerator='gpu', seed=6382, num_workers=4, save_dir='./checkpoint/FB15k-237N-ko-2023-12-13 18:49:36.472256', pretrained_model='pretrained-pro/ETRI-KEByT5-Base-230426', batch_size=16, val_batch_size=16, num_beams=40, num_beam_groups=1, src_max_length=512, train_tgt_max_length=512, eval_tgt_max_length=90, epochs=5, lr=0.0005, diversity_penalty=0.0, model_path='', optim='Adam', decoder='beam_search', log_text=False, use_prefix_search=False, src_descrip_max_length=240, tgt_descrip_max_length=240, use_soft_prompt=True, use_rel_prompt_emb=True, skip_n_val_epoch=0, seq_dropout=0.2, temporal=False, n_ent=12068, n_rel=90, vocab_size=384, model_dim=1536)
Global seed set to 6382

----------------------------------------------------------------------------------
 - pretrained_model.model_type: t5
 - tokenizer.additional_special_tokens: ['<extra_id_0>', '<extra_id_1>', '<extra_id_2>', '<extra_id_3>', '<extra_id_4>', '<extra_id_5>', '<extra_id_6>', '<extra_id_7>', '<extra_id_8>', '<extra_id_9>', '<extra_id_10>', '<extra_id_11>', '<extra_id_12>', '<extra_id_13>', '<extra_id_14>', '<extra_id_15>', '<extra_id_16>', '<extra_id_17>', '<extra_id_18>', '<extra_id_19>', '<extra_id_20>', '<extra_id_21>', '<extra_id_22>', '<extra_id_23>', '<extra_id_24>', '<extra_id_25>', '<extra_id_26>', '<extra_id_27>', '<extra_id_28>', '<extra_id_29>', '<extra_id_30>', '<extra_id_31>', '<extra_id_32>', '<extra_id_33>', '<extra_id_34>', '<extra_id_35>', '<extra_id_36>', '<extra_id_37>', '<extra_id_38>', '<extra_id_39>', '<extra_id_40>', '<extra_id_41>', '<extra_id_42>', '<extra_id_43>', '<extra_id_44>', '<extra_id_45>', '<extra_id_46>', '<extra_id_47>', '<extra_id_48>', '<extra_id_49>', '<extra_id_50>', '<extra_id_51>', '<extra_id_52>', '<extra_id_53>', '<extra_id_54>', '<extra_id_55>', '<extra_id_56>', '<extra_id_57>', '<extra_id_58>', '<extra_id_59>', '<extra_id_60>', '<extra_id_61>', '<extra_id_62>', '<extra_id_63>', '<extra_id_64>', '<extra_id_65>', '<extra_id_66>', '<extra_id_67>', '<extra_id_68>', '<extra_id_69>', '<extra_id_70>', '<extra_id_71>', '<extra_id_72>', '<extra_id_73>', '<extra_id_74>', '<extra_id_75>', '<extra_id_76>', '<extra_id_77>', '<extra_id_78>', '<extra_id_79>', '<extra_id_80>', '<extra_id_81>', '<extra_id_82>', '<extra_id_83>', '<extra_id_84>', '<extra_id_85>', '<extra_id_86>', '<extra_id_87>', '<extra_id_88>', '<extra_id_89>', '<extra_id_90>', '<extra_id_91>', '<extra_id_92>', '<extra_id_93>', '<extra_id_94>', '<extra_id_95>', '<extra_id_96>', '<extra_id_97>', '<extra_id_98>', '<extra_id_99>', '<extra_id_100>', '<extra_id_101>', '<extra_id_102>', '<extra_id_103>', '<extra_id_104>', '<extra_id_105>', '<extra_id_106>', '<extra_id_107>', '<extra_id_108>', '<extra_id_109>', '<extra_id_110>', '<extra_id_111>', '<extra_id_112>', '<extra_id_113>', '<extra_id_114>', '<extra_id_115>', '<extra_id_116>', '<extra_id_117>', '<extra_id_118>', '<extra_id_119>', '<extra_id_120>', '<extra_id_121>', '<extra_id_122>', '<extra_id_123>', '<extra_id_124>']
 - extra_id_0_tok_id: 259
----------------------------------------------------------------------------------

tokenizing entities...
100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 12068/12068 [02:46<00:00, 72.58it/s]
datamodule construction done.

----------------------------------------------------------------------------------
 * pl.Trainer(accelerator=gpu, precision=32)
----------------------------------------------------------------------------------

GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
model construction done.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [3]

  | Name          | Type                               | Params
---------------------------------------------------------------------
0 | core_t5_model | ModifiedT5ForConditionalGeneration | 581 M
1 | rel_embed1    | Embedding                          | 138 K
2 | rel_embed2    | Embedding                          | 138 K
3 | rel_embed3    | Embedding                          | 138 K
4 | rel_embed4    | Embedding                          | 138 K
---------------------------------------------------------------------
582 M     Trainable params
0         Non-trainable params
582 M     Total params
2,328.825 Total estimated model params size (MB)
Training: 0it [00:00, ?it/s]Epoch:    0,
Epoch 0:  93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                  | 9138/9866 [1:50:15<08:47,  1.38it/s, loss=0.143]Training time: 6615s
Epoch 0: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [3:33:53<00:00,  1.30s/it, loss=0.143]
                   mrr           mr   hit@1   hit@3  hit@10█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 364/364 [52:01<00:00,  8.58s/it]
tail ranking  0.390629  2385.476002  31.00%  44.14%  54.65%
head ranking  0.108526  4696.870979   8.09%  11.61%  16.67%
mean ranking  0.249578  3541.173490  19.54%  27.88%  35.66%
Ellipsis
Validation time: 6217s
Epoch 0: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [3:33:53<00:00,  1.30s/it, loss=0.143]
Total time: 12833s, loss: 0.2151
--------------------------------------------------
Epoch 0: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [3:33:53<00:00,  1.30s/it, loss=0.143]Epoch:    1,
Epoch 1:  93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                  | 9138/9866 [1:50:08<08:46,  1.38it/s, loss=0.103]Training time: 6609s
Epoch 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [3:33:50<00:00,  1.30s/it, loss=0.103]
                   mrr           mr   hit@1   hit@3  hit@10█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 364/364 [52:10<00:00,  8.60s/it]
tail ranking  0.384500  2318.183038  30.62%  42.68%  54.52%
head ranking  0.105636  4607.793222   7.41%  11.37%  17.50%
mean ranking  0.245068  3462.988130  19.02%  27.03%  36.01%
Ellipsis
Validation time: 6220s
Epoch 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [3:33:50<00:00,  1.30s/it, loss=0.103]
Total time: 12830s, loss: 0.1108
--------------------------------------------------
Epoch 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [3:33:50<00:00,  1.30s/it, loss=0.103]Epoch:    2,
Epoch 2:  93%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                  | 9138/9866 [1:50:11<08:46,  1.38it/s, loss=0.0671]Training time: 6611s
Epoch 2: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [3:34:03<00:00,  1.30s/it, loss=0.0671]
                   mrr           mr   hit@1   hit@3  hit@10█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 364/364 [52:11<00:00,  8.60s/it]
tail ranking  0.398908  2154.223465  31.45%  44.88%  56.63%
head ranking  0.117814  4550.635472   8.84%  12.32%  18.58%
mean ranking  0.258361  3352.429468  20.14%  28.60%  37.61%
Ellipsis
Validation time: 6231s
Epoch 2: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [3:34:03<00:00,  1.30s/it, loss=0.0671]
Total time: 12843s, loss: 0.0742
--------------------------------------------------
Epoch 2: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [3:34:03<00:00,  1.30s/it, loss=0.0671]Epoch:    3,
Epoch 3:  93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                  | 9138/9866 [1:50:07<08:46,  1.38it/s, loss=0.051]Training time: 6608s
Epoch 3: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [3:34:05<00:00,  1.30s/it, loss=0.051]
                   mrr           mr   hit@1   hit@3  hit@10█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 364/364 [52:06<00:00,  8.59s/it]
tail ranking  0.418440  2082.498366  34.01%  46.24%  57.25%
head ranking  0.125475  4369.988818   9.15%  13.64%  19.70%
mean ranking  0.271958  3226.243592  21.58%  29.94%  38.47%
Ellipsis
Validation time: 6237s
Epoch 3: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [3:34:05<00:00,  1.30s/it, loss=0.051]
Total time: 12845s, loss: 0.0547
--------------------------------------------------
Epoch 3: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [3:34:05<00:00,  1.30s/it, loss=0.051]Epoch:    4,
Epoch 4:  93%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                  | 9138/9866 [1:50:18<08:47,  1.38it/s, loss=0.0414]Training time: 6618s
Epoch 4: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [3:34:00<00:00,  1.30s/it, loss=0.0414]
                   mrr           mr   hit@1   hit@3  hit@10█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 364/364 [52:03<00:00,  8.58s/it]
tail ranking  0.422727  2062.030621  34.59%  46.41%  57.10%
head ranking  0.129526  4387.856873   9.48%  14.07%  19.80%
mean ranking  0.276126  3224.943747  22.04%  30.24%  38.45%
Ellipsis
Validation time: 6221s
Epoch 4: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [3:34:00<00:00,  1.30s/it, loss=0.0414]
Total time: 12840s, loss: 0.0443
--------------------------------------------------
Epoch 4: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [3:34:00<00:00,  1.30s/it, loss=0.0414]`Trainer.fit` stopped: `max_epochs=5` reached.
Epoch 4: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [3:35:00<00:00,  1.31s/it, loss=0.0414]
model_path: [./checkpoint/FB15k-237N-ko-2023-12-13 18:49:36.472256/FB15k-237N-ko-epoch=004-val_mrr=0.2761.ckpt]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [3]
Testing DataLoader 1: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 423/423 [56:15<00:00,  7.98s/it]
                   mrr           mr   hit@1   hit@3  hit@10
tail ranking  0.411945  2119.032535  33.16%  45.70%  56.61%
head ranking  0.132698  4339.842798   9.61%  14.77%  20.28%
mean ranking  0.272322  3229.437666  21.38%  30.24%  38.44%

==================================================
Epoch: test
Ellipsis
==================================================
Testing DataLoader 1: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 423/423 [56:15<00:00,  7.98s/it]
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Runningstage.testing metric      DataLoader 0             DataLoader 1
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
         val_mrr             0.272321879863739        0.272321879863739
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
(KG-S2S) chrisjihee@ptlm3:~/proj/KG-S2S$

