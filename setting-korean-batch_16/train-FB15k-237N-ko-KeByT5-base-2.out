#export CUDA_VISIBLE_DEVICES=1
#export CUDA_VISIBLE_DEVICES=5
#python3 main.py -dataset FB15k-237N-ko -lr 0.0005 -num_beams 40 -seq_dropout 0.2 -use_soft_prompt -use_rel_prompt_emb -src_descrip_max_length 200 -tgt_descrip_max_length 200 -pretrained_model pretrained-pro/ETRI-KEByT5-Base-230426
python3 main.py -dataset FB15k-237N-ko \
                -lr 0.0005 \
                -precision bf16 \
                -epoch 15 \
                -batch_size 16 \
                -val_batch_size 8 \
                -num_beams 40 \
                -seq_dropout 0.2 \
                -use_soft_prompt \
                -use_rel_prompt_emb \
                -src_descrip_max_length 240 \
                -tgt_descrip_max_length 240 \
                -eval_tgt_max_length 90 \
                -pretrained_model pretrained-pro/ETRI-KEByT5-Base-230426



(KG-S2S) dlt@dl012:~/proj/KG-S2S$ export CUDA_VISIBLE_DEVICES=7
(KG-S2S) dlt@dl012:~/proj/KG-S2S$ setting-korean-batch_16/train-FB15k-237N-ko-KeByT5-base-2.sh
Namespace(dataset_path='./data/processed', dataset='FB15k-237N-ko', model='T5Finetuner', precision='bf16', accelerator='gpu', seed=41504, num_workers=12, save_dir='./checkpoint/FB15k-237N-ko=ETRI-KEByT5-Base-230426=1219.104420', pretrained_model='pretrained-pro/ETRI-KEByT5-Base-230426', batch_size=16, val_batch_size=8, num_beams=40, num_beam_groups=1, src_max_length=512, train_tgt_max_length=512, eval_tgt_max_length=90, epochs=15, lr=0.0005, diversity_penalty=0.0, model_path='', optim='Adam', decoder='beam_search', log_text=False, use_prefix_search=False, src_descrip_max_length=240, tgt_descrip_max_length=240, use_soft_prompt=True, use_rel_prompt_emb=True, check_every_n_epochs=3, seq_dropout=0.2, temporal=False, n_ent=12068, n_rel=90, vocab_size=384, model_dim=1536)
Global seed set to 41504

----------------------------------------------------------------------------------
 - pretrained_model.model_type: t5
 - tokenizer.additional_special_tokens: ['<extra_id_0>', '<extra_id_1>', '<extra_id_2>', '<extra_id_3>', '<extra_id_4>', '<extra_id_5>', '<extra_id_6>', '<extra_id_7>', '<extra_id_8>', '<extra_id_9>', '<extra_id_10>', '<extra_id_11>', '<extra_id_12>', '<extra_id_13>', '<extra_id_14>', '<extra_id_15>', '<extra_id_16>', '<extra_id_17>', '<extra_id_18>', '<extra_id_19>', '<extra_id_20>', '<extra_id_21>', '<extra_id_22>', '<extra_id_23>', '<extra_id_24>', '<extra_id_25>', '<extra_id_26>', '<extra_id_27>', '<extra_id_28>', '<extra_id_29>', '<extra_id_30>', '<extra_id_31>', '<extra_id_32>', '<extra_id_33>', '<extra_id_34>', '<extra_id_35>', '<extra_id_36>', '<extra_id_37>', '<extra_id_38>', '<extra_id_39>', '<extra_id_40>', '<extra_id_41>', '<extra_id_42>', '<extra_id_43>', '<extra_id_44>', '<extra_id_45>', '<extra_id_46>', '<extra_id_47>', '<extra_id_48>', '<extra_id_49>', '<extra_id_50>', '<extra_id_51>', '<extra_id_52>', '<extra_id_53>', '<extra_id_54>', '<extra_id_55>', '<extra_id_56>', '<extra_id_57>', '<extra_id_58>', '<extra_id_59>', '<extra_id_60>', '<extra_id_61>', '<extra_id_62>', '<extra_id_63>', '<extra_id_64>', '<extra_id_65>', '<extra_id_66>', '<extra_id_67>', '<extra_id_68>', '<extra_id_69>', '<extra_id_70>', '<extra_id_71>', '<extra_id_72>', '<extra_id_73>', '<extra_id_74>', '<extra_id_75>', '<extra_id_76>', '<extra_id_77>', '<extra_id_78>', '<extra_id_79>', '<extra_id_80>', '<extra_id_81>', '<extra_id_82>', '<extra_id_83>', '<extra_id_84>', '<extra_id_85>', '<extra_id_86>', '<extra_id_87>', '<extra_id_88>', '<extra_id_89>', '<extra_id_90>', '<extra_id_91>', '<extra_id_92>', '<extra_id_93>', '<extra_id_94>', '<extra_id_95>', '<extra_id_96>', '<extra_id_97>', '<extra_id_98>', '<extra_id_99>', '<extra_id_100>', '<extra_id_101>', '<extra_id_102>', '<extra_id_103>', '<extra_id_104>', '<extra_id_105>', '<extra_id_106>', '<extra_id_107>', '<extra_id_108>', '<extra_id_109>', '<extra_id_110>', '<extra_id_111>', '<extra_id_112>', '<extra_id_113>', '<extra_id_114>', '<extra_id_115>', '<extra_id_116>', '<extra_id_117>', '<extra_id_118>', '<extra_id_119>', '<extra_id_120>', '<extra_id_121>', '<extra_id_122>', '<extra_id_123>', '<extra_id_124>']
 - extra_id_0_tok_id: 259
----------------------------------------------------------------------------------

tokenizing entities...
100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 12068/12068 [02:02<00:00, 98.66it/s]
datamodule construction done.

----------------------------------------------------------------------------------
 * pl.Trainer(accelerator=gpu, precision=bf16, max_epochs=15, every_n_epoch=3)
----------------------------------------------------------------------------------

Using bfloat16 Automatic Mixed Precision (AMP)
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
model construction done.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [7]

  | Name          | Type                               | Params
---------------------------------------------------------------------
0 | core_t5_model | ModifiedT5ForConditionalGeneration | 581 M
1 | rel_embed1    | Embedding                          | 138 K
2 | rel_embed2    | Embedding                          | 138 K
3 | rel_embed3    | Embedding                          | 138 K
4 | rel_embed4    | Embedding                          | 138 K
---------------------------------------------------------------------
582 M     Trainable params
0         Non-trainable params
582 M     Total params
2,328.825 Total estimated model params size (MB)
Training: 0it [00:00, ?it/s]

======================================================================
Epoch:    0,
Epoch 0: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:26<00:00,  2.70it/s, loss=0.14]
Total time: 3386s, loss: 0.2147
Epoch 0: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:26<00:00,  2.70it/s, loss=0.14]

======================================================================
Epoch:    1,
Epoch 1: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:11<00:00,  2.71it/s, loss=0.0939]
Total time: 3371s, loss: 0.1104
Epoch 1: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:11<00:00,  2.71it/s, loss=0.0939]

======================================================================
Epoch:    2,
Epoch 2: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:14<00:00,  2.71it/s, loss=0.0608]
Training time: 3374s
Epoch 2: : 10592it [2:16:26,  1.29it/s, loss=0.0608]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [40:16<00:00,  3.32s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.410838  33.08%  45.35%  56.72%
head  0.116503   8.15%  12.80%  18.60%
mean  0.263670  20.62%  29.07%  37.66%

Ellipsis
Validation time: 4811s
Epoch 2: : 10592it [2:16:26,  1.29it/s, loss=0.0608]
Total time: 8239s, loss: 0.0730
Epoch 2: : 10592it [2:17:19,  1.29it/s, loss=0.0608]

======================================================================
Epoch:    3,
Epoch 3: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:09<00:00,  2.71it/s, loss=0.0514]
Total time: 3369s, loss: 0.0542
Epoch 3: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:09<00:00,  2.71it/s, loss=0.0514]

======================================================================
Epoch:    4,
Epoch 4: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:17<00:00,  2.71it/s, loss=0.0381]
Total time: 3377s, loss: 0.0439
Epoch 4: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:17<00:00,  2.71it/s, loss=0.0381]

======================================================================
Epoch:    5,
Epoch 5:  86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                 | 9138/10592 [56:14<08:56,  2.71it/s, loss=0.0347]
Training time: 3374s
Epoch 5: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:30:37<00:00,  1.17it/s, loss=0.0347]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [54:23<00:00,  4.49s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.436901  35.76%  48.20%  58.97%
head  0.132565   9.79%  14.36%  20.64%
mean  0.284733  22.78%  31.28%  39.81%

Ellipsis
Validation time: 5663s
Epoch 5: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:30:37<00:00,  1.17it/s, loss=0.0347]
Total time: 9114s, loss: 0.0382
Epoch 5: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:31:54<00:00,  1.16it/s, loss=0.0347]

======================================================================
Epoch:    6,
Epoch 6: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [58:25<00:00,  2.61it/s, loss=0.0308]
Total time: 3505s, loss: 0.0348
Epoch 6: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [58:25<00:00,  2.61it/s, loss=0.0308]

======================================================================
Epoch:    7,
Epoch 7: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [58:41<00:00,  2.60it/s, loss=0.0303]
Total time: 3521s, loss: 0.0321
Epoch 7: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [58:41<00:00,  2.60it/s, loss=0.0303]

======================================================================
Epoch:    8,
Epoch 8:  44%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                                                                           Epoch 8:  44%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                                                           Epoch 8:  44%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                                                           Epoch 8:  44%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                                                           Epoch 8:  44%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                                                           Epoch 8:  44%|█████████████████████████████████████████████████████████████████████████                                                                                             | 4661/10592 [29:59<38:09,  2.59it/s, loss=0.0291]Epoch 8:  44%|█████████████████████████████████████████████████████████████████████████                                                                                   Epoch 8:  45%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                                                                                       | 4765/10592 [30:38<37:28,  2.Epoch 8:  45%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                                                         Epoch 8:  45%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                                                         Epoch 8:  45%|██████████████████████████████████████████████████████████████████████████▋                                                                                           Epoch 8:  86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                 | 9138/10592 [58:43<09:20,  2.59it/s, loss=0.0286]
Training time: 3523s
Epoch 8: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:51:27<00:00,  1.03it/s, loss=0.0286]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [56:48<00:00,  4.69s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.450185  37.07%  49.56%  60.21%
head  0.142176  10.34%  15.55%  22.12%
mean  0.296180  23.71%  32.56%  41.17%

Ellipsis
Validation time: 6763s
Epoch 8: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:51:27<00:00,  1.03it/s, loss=0.0286]
Total time: 10369s, loss: 0.0303
Epoch 8: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:52:49<00:00,  1.02it/s, loss=0.0286]

======================================================================
Epoch:    9,
Epoch 9: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [58:58<00:00,  2.58it/s, loss=0.0294]
Total time: 3538s, loss: 0.0288
Epoch 9: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [58:58<00:00,  2.58it/s, loss=0.0294]

======================================================================
Epoch:   10,
Epoch 10: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [59:09<00:00,  2.57it/s, loss=0.0285]
Total time: 3549s, loss: 0.0276
Epoch 10: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [59:09<00:00,  2.57it/s, loss=0.0285]

======================================================================
Epoch:   11,
Epoch 11:  86%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                 | 9138/10592 [59:16<09:25,  2.57it/s, loss=0.0255]
Training time: 3557s
Epoch 11: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:51:07<00:00,  1.03it/s, loss=0.0255]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [56:03<00:00,  4.63s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.457230  37.67%  50.30%  61.36%
head  0.145899  10.89%  15.53%  22.45%
mean  0.301565  24.28%  32.92%  41.91%

Ellipsis
Validation time: 6710s
Epoch 11: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:51:07<00:00,  1.03it/s, loss=0.0255]
Total time: 10342s, loss: 0.0267
Epoch 11: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:52:22<00:00,  1.02it/s, loss=0.0255]

======================================================================
Epoch:   12,
Epoch 12: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [59:07<00:00,  2.58it/s, loss=0.0249]
Total time: 3547s, loss: 0.0259
Epoch 12: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [59:07<00:00,  2.58it/s, loss=0.0249]

======================================================================
Epoch:   13,
Epoch 13: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [58:57<00:00,  2.58it/s, loss=0.0239]
Total time: 3537s, loss: 0.0251
Epoch 13: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [58:57<00:00,  2.58it/s, loss=0.0239]

======================================================================
Epoch:   14,
Epoch 14:  86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                 | 9138/10592 [57:24<09:08,  2.65it/s, loss=0.025]
Training time: 3444s
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:16:55<00:00,  1.29it/s, loss=0.025]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [40:03<00:00,  3.31s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.462362  37.88%  51.28%  61.64%
head  0.152300  11.01%  16.89%  23.93%
mean  0.307331  24.45%  34.09%  42.78%

Ellipsis
Validation time: 4770s
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:16:55<00:00,  1.29it/s, loss=0.025]
Total time: 8270s, loss: 0.0245
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:17:50<00:00,  1.28it/s, loss=0.025]`Trainer.fit` stopped: `max_epochs=15` reached.
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:17:50<00:00,  1.28it/s, loss=0.025]
model_path: [./checkpoint/FB15k-237N-ko=ETRI-KEByT5-Base-230426=1219.104420/FB15k-237N-ko-epoch=014-val_mrr=0.3073.ckpt]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [7]
Testing DataLoader 1: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 846/846 [43:39<00:00,  3.10s/it]


           mrr   hit@1   hit@3  hit@10
tail  0.453959  37.28%  50.41%  60.62%
head  0.154690  11.45%  16.71%  23.79%
mean  0.304325  24.36%  33.56%  42.21%

======================================================================
Epoch: test
Ellipsis
======================================================================
Testing DataLoader 1: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 846/846 [43:40<00:00,  3.10s/it]
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Runningstage.testing metric      DataLoader 0             DataLoader 1
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
         val_mrr            0.30432453751564026      0.30432453751564026
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
(KG-S2S) dlt@dl012:~/proj/KG-S2S$
