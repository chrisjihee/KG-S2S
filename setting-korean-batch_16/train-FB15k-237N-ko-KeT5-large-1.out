#export CUDA_VISIBLE_DEVICES=2
#export CUDA_VISIBLE_DEVICES=6
#python3 main.py -dataset FB15k-237N-ko -lr 0.001 -num_beams 40 -seq_dropout 0.2 -use_soft_prompt -use_rel_prompt_emb -src_descrip_max_length 200 -tgt_descrip_max_length 200 -pretrained_model KETI-AIR/ke-t5-base-ko
python3 main.py -dataset FB15k-237N-ko \
                -lr 0.001 \
                -precision bf16 \
                -epoch 15 \
                -batch_size 16 \
                -val_batch_size 8 \
                -num_beams 40 \
                -seq_dropout 0.2 \
                -use_soft_prompt \
                -use_rel_prompt_emb \
                -src_descrip_max_length 240 \
                -tgt_descrip_max_length 240 \
                -eval_tgt_max_length 90 \
                -pretrained_model KETI-AIR/ke-t5-large-ko



(KG-S2S) chrisjihee@ptlm3:~/proj/KG-S2S$ export CUDA_VISIBLE_DEVICES=2
(KG-S2S) chrisjihee@ptlm3:~/proj/KG-S2S$ setting-korean-batch_16/train-FB15k-237N-ko-KeT5-large-1.sh
Namespace(dataset_path='./data/processed', dataset='FB15k-237N-ko', model='T5Finetuner', precision='bf16', accelerator='gpu', seed=41504, num_workers=12, save_dir='./checkpoint/FB15k-237N-ko=ke-t5-large-ko=1219.014558', pretrained_model='KETI-AIR/ke-t5-large-ko', batch_size=16, val_batch_size=8, num_beams=40, num_beam_groups=1, src_max_length=512, train_tgt_max_length=512, eval_tgt_max_length=90, epochs=15, lr=0.001, diversity_penalty=0.0, model_path='', optim='Adam', decoder='beam_search', log_text=False, use_prefix_search=False, src_descrip_max_length=240, tgt_descrip_max_length=240, use_soft_prompt=True, use_rel_prompt_emb=True, check_every_n_epochs=3, seq_dropout=0.2, temporal=False, n_ent=12068, n_rel=90, vocab_size=64128, model_dim=1024)
Global seed set to 41504
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.

----------------------------------------------------------------------------------
 - pretrained_model.model_type: t5
 - tokenizer.additional_special_tokens: ['<extra_id_0>', '<extra_id_1>', '<extra_id_2>', '<extra_id_3>', '<extra_id_4>', '<extra_id_5>', '<extra_id_6>', '<extra_id_7>', '<extra_id_8>', '<extra_id_9>', '<extra_id_10>', '<extra_id_11>', '<extra_id_12>', '<extra_id_13>', '<extra_id_14>', '<extra_id_15>', '<extra_id_16>', '<extra_id_17>', '<extra_id_18>', '<extra_id_19>', '<extra_id_20>', '<extra_id_21>', '<extra_id_22>', '<extra_id_23>', '<extra_id_24>', '<extra_id_25>', '<extra_id_26>', '<extra_id_27>', '<extra_id_28>', '<extra_id_29>', '<extra_id_30>', '<extra_id_31>', '<extra_id_32>', '<extra_id_33>', '<extra_id_34>', '<extra_id_35>', '<extra_id_36>', '<extra_id_37>', '<extra_id_38>', '<extra_id_39>', '<extra_id_40>', '<extra_id_41>', '<extra_id_42>', '<extra_id_43>', '<extra_id_44>', '<extra_id_45>', '<extra_id_46>', '<extra_id_47>', '<extra_id_48>', '<extra_id_49>', '<extra_id_50>', '<extra_id_51>', '<extra_id_52>', '<extra_id_53>', '<extra_id_54>', '<extra_id_55>', '<extra_id_56>', '<extra_id_57>', '<extra_id_58>', '<extra_id_59>', '<extra_id_60>', '<extra_id_61>', '<extra_id_62>', '<extra_id_63>', '<extra_id_64>', '<extra_id_65>', '<extra_id_66>', '<extra_id_67>', '<extra_id_68>', '<extra_id_69>', '<extra_id_70>', '<extra_id_71>', '<extra_id_72>', '<extra_id_73>', '<extra_id_74>', '<extra_id_75>', '<extra_id_76>', '<extra_id_77>', '<extra_id_78>', '<extra_id_79>', '<extra_id_80>', '<extra_id_81>', '<extra_id_82>', '<extra_id_83>', '<extra_id_84>', '<extra_id_85>', '<extra_id_86>', '<extra_id_87>', '<extra_id_88>', '<extra_id_89>', '<extra_id_90>', '<extra_id_91>', '<extra_id_92>', '<extra_id_93>', '<extra_id_94>', '<extra_id_95>', '<extra_id_96>', '<extra_id_97>', '<extra_id_98>', '<extra_id_99>']
 - extra_id_0_tok_id: 64099
----------------------------------------------------------------------------------

tokenizing entities...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 12068/12068 [00:28<00:00, 430.71it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
datamodule construction done.

----------------------------------------------------------------------------------
 * pl.Trainer(accelerator=gpu, precision=bf16, max_epochs=15, every_n_epoch=3)
----------------------------------------------------------------------------------

Using bfloat16 Automatic Mixed Precision (AMP)
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
model construction done.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [2]

  | Name          | Type                               | Params
---------------------------------------------------------------------
0 | core_t5_model | ModifiedT5ForConditionalGeneration | 783 M
1 | rel_embed1    | Embedding                          | 92.2 K
2 | rel_embed2    | Embedding                          | 92.2 K
3 | rel_embed3    | Embedding                          | 92.2 K
4 | rel_embed4    | Embedding                          | 92.2 K
---------------------------------------------------------------------
783 M     Trainable params
0         Non-trainable params
783 M     Total params
3,133.551 Total estimated model params size (MB)
Training: 0it [00:00, ?it/s]

======================================================================
Epoch:    0,
Epoch 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:59<00:00,  2.67it/s, loss=0.189]
Total time: 3419s, loss: 0.5159
Epoch 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:59<00:00,  2.67it/s, loss=0.189]

======================================================================
Epoch:    1,
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:58<00:00,  2.67it/s, loss=0.129]
Total time: 3418s, loss: 0.1674
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:58<00:00,  2.67it/s, loss=0.129]

======================================================================
Epoch:    2,
Epoch 2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:49<00:00,  2.68it/s, loss=0.121]
Training time: 3409s
Epoch 2: : 10592it [3:38:35,  1.24s/it, loss=0.121]
Validation DataLoader 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:20:20<00:00,  6.63s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.263138  19.99%  28.13%  39.89%
head  0.047095   2.75%   4.94%   8.88%
mean  0.155116  11.37%  16.53%  24.38%

Ellipsis
Validation time: 9706s
Epoch 2: : 10592it [3:38:35,  1.24s/it, loss=0.121]
Total time: 13136s, loss: 0.1397
Epoch 2: : 10592it [3:38:56,  1.24s/it, loss=0.121]

======================================================================
Epoch:    3,
Epoch 3: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:59<00:00,  2.67it/s, loss=0.0972]
Total time: 3419s, loss: 0.1135
Epoch 3: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:59<00:00,  2.67it/s, loss=0.0972]

======================================================================
Epoch:    4,
Epoch 4: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:58<00:00,  2.67it/s, loss=0.109]
Total time: 3418s, loss: 0.1124
Epoch 4: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:58<00:00,  2.67it/s, loss=0.109]

======================================================================
Epoch:    5,
Epoch 5:  86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                  | 9138/10592 [56:51<09:02,  2.68it/s, loss=0.13]
Training time: 3412s
Epoch 5: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:41:12<00:00,  1.25s/it, loss=0.13]
Validation DataLoader 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:22:36<00:00,  6.82s/it]

           mrr  hit@1  hit@3  hit@10
tail  0.095209  5.14%  8.74%  19.83%
head  0.027555  1.63%  3.06%   5.09%
mean  0.061382  3.39%  5.90%  12.46%

Ellipsis
Validation time: 9860s
Epoch 5: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:41:12<00:00,  1.25s/it, loss=0.13]
Total time: 13293s, loss: 0.1117
Epoch 5: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:41:33<00:00,  1.26s/it, loss=0.13]

======================================================================
Epoch:    6,
Epoch 6: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:58<00:00,  2.67it/s, loss=0.112]
Total time: 3418s, loss: 0.1014
Epoch 6: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:58<00:00,  2.67it/s, loss=0.112]

======================================================================
Epoch:    7,
Epoch 7: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [57:01<00:00,  2.67it/s, loss=0.102]
Total time: 3421s, loss: 0.1017
Epoch 7: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [57:01<00:00,  2.67it/s, loss=0.102]

======================================================================
Epoch:    8,
Epoch 8:  86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                 | 9138/10592 [56:55<09:03,  2.68it/s, loss=0.0921]
Training time: 3416s
Epoch 8: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:39:18<00:00,  1.24s/it, loss=0.0921]
Validation DataLoader 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:21:30<00:00,  6.73s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.243379  15.29%  28.73%  40.39%
head  0.053546   2.94%   5.63%  10.32%
mean  0.148462   9.12%  17.18%  25.36%

Ellipsis
Validation time: 9742s
Epoch 8: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:39:18<00:00,  1.24s/it, loss=0.0921]
Total time: 13180s, loss: 0.0986
Epoch 8: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:39:40<00:00,  1.24s/it, loss=0.0921]

======================================================================
Epoch:    9,
Epoch 9: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:54<00:00,  2.68it/s, loss=0.0946]
Total time: 3414s, loss: 0.0952
Epoch 9: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:54<00:00,  2.68it/s, loss=0.0946]

======================================================================
Epoch:   10,
Epoch 10: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [57:00<00:00,  2.67it/s, loss=0.0797]
Total time: 3420s, loss: 0.0899
Epoch 10: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [57:00<00:00,  2.67it/s, loss=0.0797]

======================================================================
Epoch:   11,
Epoch 11:  86%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                 | 9138/10592 [57:00<09:04,  2.67it/s, loss=0.0971]
Training time: 3420s
Epoch 11:  89%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                           | 9407/10592 [1:26:06<10:50,  1.82it/s, loss=0.0971]
Epoch 11:  89%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                           | 9413/10592 [1:26:45<10:51,  1.81it/s, loss=0.0971]
Epoch 11:  89%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                  | 9414/10592 [1:26:52<10:52,  1.81it/s, loss=0.0971]
Epoch 11: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:37:26<00:00,  1.23s/it, loss=0.0971]
Validation DataLoader 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:21:19<00:00,  6.71s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.269269  19.04%  30.36%  43.09%
head  0.057823   3.51%   5.90%  10.65%
mean  0.163546  11.28%  18.13%  26.87%

Ellipsis
Validation time: 9626s
Epoch 11: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:37:26<00:00,  1.23s/it, loss=0.0971]
Total time: 13068s, loss: 0.0894
Epoch 11: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:37:48<00:00,  1.23s/it, loss=0.0971]

======================================================================
Epoch:   12,
Epoch 12: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:56<00:00,  2.67it/s, loss=0.0874]
Total time: 3416s, loss: 0.0869
Epoch 12: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:56<00:00,  2.67it/s, loss=0.0874]

======================================================================
Epoch:   13,
Epoch 13: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:56<00:00,  2.67it/s, loss=0.0912]
Total time: 3416s, loss: 0.0852
Epoch 13: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [56:56<00:00,  2.67it/s, loss=0.0912]

======================================================================
Epoch:   14,
Epoch 14:  86%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                 | 9138/10592 [56:56<09:03,  2.67it/s, loss=0.0813]
Training time: 3417s
Epoch 14: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:35:50<00:00,  1.22s/it, loss=0.0813]
Validation DataLoader 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:19:04<00:00,  6.53s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.288041  21.19%  31.72%  44.35%
head  0.063903   3.92%   6.59%  11.44%
mean  0.175972  12.56%  19.16%  27.89%

Ellipsis
Validation time: 9533s
Epoch 14: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:35:50<00:00,  1.22s/it, loss=0.0813]
Total time: 12972s, loss: 0.0845
Epoch 14: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:36:12<00:00,  1.22s/it, loss=0.0813]`Trainer.fit` stopped: `max_epochs=15` reached.
Epoch 14: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:36:12<00:00,  1.22s/it, loss=0.0813]
model_path: [./checkpoint/FB15k-237N-ko=ke-t5-large-ko=1219.014558/FB15k-237N-ko-epoch=014-val_mrr=0.1760.ckpt]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [2]
Testing DataLoader 1: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 846/846 [1:23:13<00:00,  5.90s/it]


           mrr   hit@1   hit@3  hit@10
tail  0.282483  20.62%  31.13%  44.25%
head  0.065344   4.04%   6.82%  11.49%
mean  0.173913  12.33%  18.97%  27.87%

======================================================================
Epoch: test
Ellipsis
======================================================================
Testing DataLoader 1: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 846/846 [1:23:13<00:00,  5.90s/it]
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Runningstage.testing metric      DataLoader 0             DataLoader 1
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
         val_mrr            0.17391328513622284      0.17391328513622284
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
(KG-S2S) chrisjihee@ptlm3:~/proj/KG-S2S$

