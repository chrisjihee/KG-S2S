#export CUDA_VISIBLE_DEVICES=0
#export CUDA_VISIBLE_DEVICES=4
#python3 main.py -dataset FB15k-237N-ko -lr 0.001 -num_beams 40 -seq_dropout 0.2 -use_soft_prompt -use_rel_prompt_emb -src_descrip_max_length 200 -tgt_descrip_max_length 200 -pretrained_model google/mt5-base
python3 main.py -dataset FB15k-237N-ko \
                -lr 0.001 \
                -precision bf16 \
                -epoch 15 \
                -batch_size 16 \
                -val_batch_size 8 \
                -num_beams 40 \
                -seq_dropout 0.2 \
                -use_soft_prompt \
                -use_rel_prompt_emb \
                -src_descrip_max_length 240 \
                -tgt_descrip_max_length 240 \
                -eval_tgt_max_length 90 \
                -pretrained_model google/mt5-base



(KG-S2S) dlt@dl012:~/proj/KG-S2S$ export CUDA_VISIBLE_DEVICES=4
(KG-S2S) dlt@dl012:~/proj/KG-S2S$ setting-korean-batch_16/train-FB15k-237N-ko-MT5-base-1.sh
Namespace(dataset_path='./data/processed', dataset='FB15k-237N-ko', model='T5Finetuner', precision='bf16', accelerator='gpu', seed=41504, num_workers=12, save_dir='./checkpoint/FB15k-237N-ko=mt5-base=1219.104410', pretrained_model='google/mt5-base', batch_size=16, val_batch_size=8, num_beams=40, num_beam_groups=1, src_max_length=512, train_tgt_max_length=512, eval_tgt_max_length=90, epochs=15, lr=0.001, diversity_penalty=0.0, model_path='', optim='Adam', decoder='beam_search', log_text=False, use_prefix_search=False, src_descrip_max_length=240, tgt_descrip_max_length=240, use_soft_prompt=True, use_rel_prompt_emb=True, check_every_n_epochs=3, seq_dropout=0.2, temporal=False, n_ent=12068, n_rel=90, vocab_size=250112, model_dim=768)
Global seed set to 41504
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.

----------------------------------------------------------------------------------
 - pretrained_model.model_type: mt5
 - tokenizer.additional_special_tokens: ['<extra_id_0>', '<extra_id_1>']
 - extra_id_0_tok_id: 250100
----------------------------------------------------------------------------------

tokenizing entities...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 12068/12068 [00:20<00:00, 600.67it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
datamodule construction done.

----------------------------------------------------------------------------------
 * pl.Trainer(accelerator=gpu, precision=bf16, max_epochs=15, every_n_epoch=3)
----------------------------------------------------------------------------------

Using bfloat16 Automatic Mixed Precision (AMP)
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
model construction done.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [4]

  | Name          | Type                                | Params
----------------------------------------------------------------------
0 | core_t5_model | ModifiedMT5ForConditionalGeneration | 582 M
1 | rel_embed1    | Embedding                           | 69.1 K
2 | rel_embed2    | Embedding                           | 69.1 K
3 | rel_embed3    | Embedding                           | 69.1 K
4 | rel_embed4    | Embedding                           | 69.1 K
----------------------------------------------------------------------
582 M     Trainable params
0         Non-trainable params
582 M     Total params
2,330.711 Total estimated model params size (MB)
Training: 0it [00:00, ?it/s]

======================================================================
Epoch:    0,
Epoch 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:21<00:00,  7.13it/s, loss=0.341]
Total time: 1281s, loss: 0.6280
Epoch 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:21<00:00,  7.13it/s, loss=0.341]

======================================================================
Epoch:    1,
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:14<00:00,  7.17it/s, loss=0.222]
Total time: 1274s, loss: 0.2703
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:14<00:00,  7.17it/s, loss=0.222]

======================================================================
Epoch:    2,
Epoch 2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:17<00:00,  7.15it/s, loss=0.141]
Training time: 1277s
Epoch 2: : 10592it [2:03:33,  1.43it/s, loss=0.141]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [51:34<00:00,  4.26s/it]

           mrr  hit@1   hit@3  hit@10
tail  0.096883  6.06%  10.67%  19.66%
head  0.017999  1.43%   1.88%   2.12%
mean  0.057441  3.74%   6.27%  10.89%

Ellipsis
Validation time: 6135s
Epoch 2: : 10592it [2:03:33,  1.43it/s, loss=0.141]
Total time: 7435s, loss: 0.1744
Epoch 2: : 10592it [2:03:55,  1.42it/s, loss=0.141]

======================================================================
Epoch:    3,
Epoch 3: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:12<00:00,  7.18it/s, loss=0.131]
Total time: 1272s, loss: 0.1354
Epoch 3: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:12<00:00,  7.18it/s, loss=0.131]

======================================================================
Epoch:    4,
Epoch 4: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:16<00:00,  7.16it/s, loss=0.119]
Total time: 1276s, loss: 0.1182
Epoch 4: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:16<00:00,  7.16it/s, loss=0.119]

======================================================================
Epoch:    5,
Epoch 5:  86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                  | 9138/10592 [21:16<03:23,  7.16it/s, loss=0.111]
Training time: 1276s
Epoch 5: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:03:57<00:00,  1.42it/s, loss=0.111]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [51:40<00:00,  4.27s/it]

           mrr  hit@1  hit@3  hit@10
tail  0.094467  5.16%  8.17%  18.65%
head  0.029478  1.86%  3.20%   4.97%
mean  0.061973  3.51%  5.69%  11.81%

Ellipsis
Validation time: 6160s
Epoch 5: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:03:57<00:00,  1.42it/s, loss=0.111]
Total time: 7460s, loss: 0.1095
Epoch 5: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:04:20<00:00,  1.42it/s, loss=0.111]

======================================================================
Epoch:    6,
Epoch 6: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:11<00:00,  7.18it/s, loss=0.105]
Total time: 1271s, loss: 0.1031
Epoch 6: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:11<00:00,  7.18it/s, loss=0.105]

======================================================================
Epoch:    7,
Epoch 7: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:15<00:00,  7.17it/s, loss=0.0907]
Total time: 1275s, loss: 0.0978
Epoch 7: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:15<00:00,  7.17it/s, loss=0.0907]

======================================================================
Epoch:    8,
Epoch 8:  86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                 | 9138/10592 [21:10<03:22,  7.19it/s, loss=0.0946]
Training time: 1270s
Epoch 8: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:15:29<00:00,  1.30it/s, loss=0.0946]
Validation DataLoader 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:03:12<00:00,  5.22s/it]

           mrr  hit@1   hit@3  hit@10
tail  0.118833  7.07%  12.20%  21.28%
head  0.034035  2.15%   3.53%   4.77%
mean  0.076434  4.61%   7.86%  13.02%

Ellipsis
Validation time: 6858s
Epoch 8: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:15:29<00:00,  1.30it/s, loss=0.0946]
Total time: 8162s, loss: 0.0943
Epoch 8: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:16:02<00:00,  1.30it/s, loss=0.0946]

======================================================================
Epoch:    9,
Epoch 9: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [27:40<00:00,  5.50it/s, loss=0.0895]
Total time: 1660s, loss: 0.0921
Epoch 9: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [27:40<00:00,  5.50it/s, loss=0.0895]

======================================================================
Epoch:   10,
Epoch 10: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [27:15<00:00,  5.59it/s, loss=0.0917]
Total time: 1635s, loss: 0.0915
Epoch 10: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [27:15<00:00,  5.59it/s, loss=0.0917]

======================================================================
Epoch:   11,
Epoch 11:  86%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                 | 9138/10592 [27:00<04:17,  5.64it/s, loss=0.0892]
Training time: 1620s
Epoch 11: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:41:12<00:00,  1.10it/s, loss=0.0892]
Validation DataLoader 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:07:51<00:00,  5.60s/it]

           mrr  hit@1  hit@3  hit@10
tail  0.078887  4.58%  6.64%  15.31%
head  0.025439  1.77%  2.41%   3.66%
mean  0.052163  3.17%  4.52%   9.49%

Ellipsis
Validation time: 8051s
Epoch 11: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:41:12<00:00,  1.10it/s, loss=0.0892]
Total time: 9704s, loss: 0.1182
Epoch 11: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:41:44<00:00,  1.09it/s, loss=0.0892]

======================================================================
Epoch:   12,
Epoch 12: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [28:07<00:00,  5.41it/s, loss=0.111]
Total time: 1687s, loss: 0.1938
Epoch 12: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [28:07<00:00,  5.41it/s, loss=0.111]

======================================================================
Epoch:   13,
Epoch 13: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [27:45<00:00,  5.49it/s, loss=0.097]
Total time: 1665s, loss: 0.0969
Epoch 13: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [27:45<00:00,  5.49it/s, loss=0.097]

======================================================================
Epoch:   14,
Epoch 14:  86%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                 | 9138/10592 [27:32<04:22,  5.53it/s, loss=0.0954]
Training time: 1652s
Epoch 14: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:40:52<00:00,  1.10it/s, loss=0.0954]
Validation DataLoader 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:07:05<00:00,  5.54s/it]

           mrr  hit@1  hit@3  hit@10
tail  0.083499  4.89%  7.88%  13.52%
head  0.023983  1.63%  2.51%   3.56%
mean  0.053741  3.26%  5.20%   8.54%

Ellipsis
Validation time: 8000s
Epoch 14: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:40:52<00:00,  1.10it/s, loss=0.0954]
Total time: 9684s, loss: 0.0916
Epoch 14: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:41:24<00:00,  1.09it/s, loss=0.0954]`Trainer.fit` stopped: `max_epochs=15` reached.
Epoch 14: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:41:24<00:00,  1.09it/s, loss=0.0954]
model_path: [./checkpoint/FB15k-237N-ko=mt5-base=1219.104410/FB15k-237N-ko-epoch=008-val_mrr=0.0764.ckpt]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [4]
Testing DataLoader 1: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 846/846 [1:13:19<00:00,  5.20s/it]


           mrr  hit@1   hit@3  hit@10
tail  0.119873  7.48%  11.90%  21.52%
head  0.035162  2.31%   3.64%   4.95%
mean  0.077517  4.90%   7.77%  13.24%

======================================================================
Epoch: test
Ellipsis
======================================================================
Testing DataLoader 1: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 846/846 [1:13:19<00:00,  5.20s/it]
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Runningstage.testing metric      DataLoader 0             DataLoader 1
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
         val_mrr            0.07751748710870743      0.07751748710870743
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
(KG-S2S) dlt@dl012:~/proj/KG-S2S$

