#export CUDA_VISIBLE_DEVICES=1
#export CUDA_VISIBLE_DEVICES=5
#python3 main.py -dataset FB15k-237N-ko -lr 0.0005 -num_beams 40 -seq_dropout 0.2 -use_soft_prompt -use_rel_prompt_emb -src_descrip_max_length 200 -tgt_descrip_max_length 200 -pretrained_model google/mt5-base
python3 main.py -dataset FB15k-237N-ko \
                -lr 0.0005 \
                -precision bf16 \
                -epoch 15 \
                -batch_size 16 \
                -val_batch_size 8 \
                -num_beams 40 \
                -seq_dropout 0.2 \
                -use_soft_prompt \
                -use_rel_prompt_emb \
                -src_descrip_max_length 240 \
                -tgt_descrip_max_length 240 \
                -eval_tgt_max_length 90 \
                -pretrained_model google/mt5-base


(KG-S2S) dlt@dl012:~/proj/KG-S2S$ export CUDA_VISIBLE_DEVICES=5
(KG-S2S) dlt@dl012:~/proj/KG-S2S$ setting-korean-batch_16/train-FB15k-237N-ko-MT5-base-2.sh
Namespace(dataset_path='./data/processed', dataset='FB15k-237N-ko', model='T5Finetuner', precision='bf16', accelerator='gpu', seed=41504, num_workers=12, save_dir='./checkpoint/FB15k-237N-ko=mt5-base=1219.104413', pretrained_model='google/mt5-base', batch_size=16, val_batch_size=8, num_beams=40, num_beam_groups=1, src_max_length=512, train_tgt_max_length=512, eval_tgt_max_length=90, epochs=15, lr=0.0005, diversity_penalty=0.0, model_path='', optim='Adam', decoder='beam_search', log_text=False, use_prefix_search=False, src_descrip_max_length=240, tgt_descrip_max_length=240, use_soft_prompt=True, use_rel_prompt_emb=True, check_every_n_epochs=3, seq_dropout=0.2, temporal=False, n_ent=12068, n_rel=90, vocab_size=250112, model_dim=768)
Global seed set to 41504
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.

----------------------------------------------------------------------------------
 - pretrained_model.model_type: mt5
 - tokenizer.additional_special_tokens: ['<extra_id_0>', '<extra_id_1>']
 - extra_id_0_tok_id: 250100
----------------------------------------------------------------------------------

tokenizing entities...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 12068/12068 [00:19<00:00, 612.06it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
datamodule construction done.

----------------------------------------------------------------------------------
 * pl.Trainer(accelerator=gpu, precision=bf16, max_epochs=15, every_n_epoch=3)
----------------------------------------------------------------------------------

Using bfloat16 Automatic Mixed Precision (AMP)
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
model construction done.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [5]

  | Name          | Type                                | Params
----------------------------------------------------------------------
0 | core_t5_model | ModifiedMT5ForConditionalGeneration | 582 M
1 | rel_embed1    | Embedding                           | 69.1 K
2 | rel_embed2    | Embedding                           | 69.1 K
3 | rel_embed3    | Embedding                           | 69.1 K
4 | rel_embed4    | Embedding                           | 69.1 K
----------------------------------------------------------------------
582 M     Trainable params
0         Non-trainable params
582 M     Total params
2,330.711 Total estimated model params size (MB)
Training: 0it [00:00, ?it/s]

======================================================================
Epoch:    0,
Epoch 0: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:25<00:00,  7.11it/s, loss=0.45]
Total time: 1285s, loss: 0.8578
Epoch 0: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:25<00:00,  7.11it/s, loss=0.45]

======================================================================
Epoch:    1,
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:25<00:00,  7.11it/s, loss=0.286]
Total time: 1285s, loss: 0.3561
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:25<00:00,  7.11it/s, loss=0.286]

======================================================================
Epoch:    2,
Epoch 2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:21<00:00,  7.13it/s, loss=0.168]
Training time: 1281s
Epoch 2: : 10592it [2:00:20,  1.47it/s, loss=0.168]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [49:46<00:00,  4.11s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.308150  23.33%  33.87%  46.07%
head  0.069713   4.52%   7.21%  12.25%
mean  0.188932  13.93%  20.54%  29.16%

Ellipsis
Validation time: 5939s
Epoch 2: : 10592it [2:00:20,  1.47it/s, loss=0.168]
Total time: 7242s, loss: 0.2200
Epoch 2: : 10592it [2:00:42,  1.46it/s, loss=0.168]

======================================================================
Epoch:    3,
Epoch 3: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:27<00:00,  7.10it/s, loss=0.133]
Total time: 1287s, loss: 0.1518
Epoch 3: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:27<00:00,  7.10it/s, loss=0.133]

======================================================================
Epoch:    4,
Epoch 4: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:27<00:00,  7.10it/s, loss=0.108]
Total time: 1287s, loss: 0.1103
Epoch 4: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:27<00:00,  7.10it/s, loss=0.108]

======================================================================
Epoch:    5,
Epoch 5:  86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                 | 9138/10592 [21:24<03:24,  7.11it/s, loss=0.0963]
Training time: 1284s
Epoch 5: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:00:52<00:00,  1.46it/s, loss=0.0963]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [50:07<00:00,  4.14s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.401487  32.01%  44.23%  55.46%
head  0.117110   8.39%  12.61%  18.22%
mean  0.259298  20.20%  28.42%  36.84%

Ellipsis
Validation time: 5967s
Epoch 5: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:00:52<00:00,  1.46it/s, loss=0.0963]
Total time: 7273s, loss: 0.0958
Epoch 5: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:01:13<00:00,  1.46it/s, loss=0.0963]

======================================================================
Epoch:    6,
Epoch 6: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:20<00:00,  7.14it/s, loss=0.0903]
Total time: 1280s, loss: 0.0929
Epoch 6: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:20<00:00,  7.14it/s, loss=0.0903]

======================================================================
Epoch:    7,
Epoch 7: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:21<00:00,  7.13it/s, loss=0.0713]
Total time: 1281s, loss: 0.0763
Epoch 7: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [21:21<00:00,  7.13it/s, loss=0.0713]

======================================================================
Epoch:    8,
Epoch 8:  86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                  | 9138/10592 [21:25<03:24,  7.11it/s, loss=0.073]
Training time: 1285s
Epoch 8: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:09:06<00:00,  1.37it/s, loss=0.073]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [58:31<00:00,  4.83s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.425227  34.85%  46.45%  57.58%
head  0.129643   9.51%  13.92%  19.73%
mean  0.277435  22.18%  30.18%  38.65%

Ellipsis
Validation time: 6460s
Epoch 8: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:09:06<00:00,  1.37it/s, loss=0.073]
Total time: 7781s, loss: 0.0728
Epoch 8: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:09:41<00:00,  1.36it/s, loss=0.073]

======================================================================
Epoch:    9,
Epoch 9: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [27:05<00:00,  5.62it/s, loss=0.0688]
Total time: 1625s, loss: 0.0685
Epoch 9: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [27:05<00:00,  5.62it/s, loss=0.0688]

======================================================================
Epoch:   10,
Epoch 10: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [26:57<00:00,  5.65it/s, loss=0.0663]
Total time: 1617s, loss: 0.0652
Epoch 10: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [26:57<00:00,  5.65it/s, loss=0.0663]

======================================================================
Epoch:   11,
Epoch 11:  86%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                 | 9138/10592 [26:50<04:16,  5.67it/s, loss=0.0584]
Training time: 1611s
Epoch 11: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:37:08<00:00,  1.12it/s, loss=0.0584]
Validation DataLoader 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:05:46<00:00,  5.43s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.426635  34.22%  47.19%  58.75%
head  0.137298  10.15%  14.30%  21.21%
mean  0.281967  22.18%  30.74%  39.98%

Ellipsis
Validation time: 7817s
Epoch 11: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:37:08<00:00,  1.12it/s, loss=0.0584]
Total time: 9460s, loss: 0.0630
Epoch 11: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:37:40<00:00,  1.12it/s, loss=0.0584]

======================================================================
Epoch:   12,
Epoch 12: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [27:46<00:00,  5.48it/s, loss=0.064]
Total time: 1666s, loss: 0.0606
Epoch 12: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [27:46<00:00,  5.48it/s, loss=0.064]

======================================================================
Epoch:   13,
Epoch 13: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [27:36<00:00,  5.52it/s, loss=0.0609]
Total time: 1656s, loss: 0.0585
Epoch 13: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [27:36<00:00,  5.52it/s, loss=0.0609]

======================================================================
Epoch:   14,
Epoch 14:  86%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                 | 9138/10592 [27:31<04:22,  5.53it/s, loss=0.0604]
Training time: 1651s
Epoch 14: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:37:41<00:00,  1.12it/s, loss=0.0604]
Validation DataLoader 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:05:01<00:00,  5.37s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.441909  36.26%  48.22%  59.57%
head  0.145657  10.73%  15.41%  22.43%
mean  0.293783  23.50%  31.82%  41.00%

Ellipsis
Validation time: 7809s
Epoch 14: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:37:41<00:00,  1.12it/s, loss=0.0604]
Total time: 9495s, loss: 0.0568
Epoch 14: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:38:15<00:00,  1.12it/s, loss=0.0604]`Trainer.fit` stopped: `max_epochs=15` reached.
Epoch 14: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [2:38:15<00:00,  1.12it/s, loss=0.0604]
model_path: [./checkpoint/FB15k-237N-ko=mt5-base=1219.104413/FB15k-237N-ko-epoch=014-val_mrr=0.2938.ckpt]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [5]
Testing DataLoader 1: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 846/846 [1:12:55<00:00,  5.17s/it]


           mrr   hit@1   hit@3  hit@10
tail  0.441897  36.63%  48.02%  59.05%
head  0.152223  11.45%  15.99%  22.83%
mean  0.297060  24.04%  32.00%  40.94%

======================================================================
Epoch: test
Ellipsis
======================================================================
Testing DataLoader 1: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 846/846 [1:12:55<00:00,  5.17s/it]
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Runningstage.testing metric      DataLoader 0             DataLoader 1
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
         val_mrr            0.2970598042011261       0.2970598042011261
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
(KG-S2S) dlt@dl012:~/proj/KG-S2S$

