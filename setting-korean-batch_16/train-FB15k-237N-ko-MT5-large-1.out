#export CUDA_VISIBLE_DEVICES=0
#export CUDA_VISIBLE_DEVICES=4
#python3 main.py -dataset FB15k-237N-ko -lr 0.001 -num_beams 40 -seq_dropout 0.2 -use_soft_prompt -use_rel_prompt_emb -src_descrip_max_length 200 -tgt_descrip_max_length 200 -pretrained_model google/mt5-base
python3 main.py -dataset FB15k-237N-ko \
                -lr 0.001 \
                -precision bf16 \
                -epoch 15 \
                -batch_size 16 \
                -val_batch_size 8 \
                -num_beams 40 \
                -seq_dropout 0.2 \
                -use_soft_prompt \
                -use_rel_prompt_emb \
                -src_descrip_max_length 240 \
                -tgt_descrip_max_length 240 \
                -eval_tgt_max_length 90 \
                -pretrained_model google/mt5-large



(KG-S2S) dlt@dl013:~/proj/KG-S2S$ export CUDA_VISIBLE_DEVICES=0
(KG-S2S) dlt@dl013:~/proj/KG-S2S$ setting-korean-batch_16/train-FB15k-237N-ko-MT5-large-1.sh
Namespace(dataset_path='./data/processed', dataset='FB15k-237N-ko', model='T5Finetuner', precision='bf16', accelerator='gpu', seed=41504, num_workers=12, save_dir='./checkpoint/FB15k-237N-ko=mt5-large=1219.104313', pretrained_model='google/mt5-large', batch_size=16, val_batch_size=8, num_beams=40, num_beam_groups=1, src_max_length=512, train_tgt_max_length=512, eval_tgt_max_length=90, epochs=15, lr=0.001, diversity_penalty=0.0, model_path='', optim='Adam', decoder='beam_search', log_text=False, use_prefix_search=False, src_descrip_max_length=240, tgt_descrip_max_length=240, use_soft_prompt=True, use_rel_prompt_emb=True, check_every_n_epochs=3, seq_dropout=0.2, temporal=False, n_ent=12068, n_rel=90, vocab_size=250112, model_dim=1024)
Global seed set to 41504
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.

----------------------------------------------------------------------------------
 - pretrained_model.model_type: mt5
 - tokenizer.additional_special_tokens: ['<extra_id_0>', '<extra_id_1>']
 - extra_id_0_tok_id: 250100
----------------------------------------------------------------------------------

tokenizing entities...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 12068/12068 [00:19<00:00, 625.64it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
datamodule construction done.

----------------------------------------------------------------------------------
 * pl.Trainer(accelerator=gpu, precision=bf16, max_epochs=15, every_n_epoch=3)
----------------------------------------------------------------------------------

Using bfloat16 Automatic Mixed Precision (AMP)
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
model construction done.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]

  | Name          | Type                                | Params
----------------------------------------------------------------------
0 | core_t5_model | ModifiedMT5ForConditionalGeneration | 1.2 B
1 | rel_embed1    | Embedding                           | 92.2 K
2 | rel_embed2    | Embedding                           | 92.2 K
3 | rel_embed3    | Embedding                           | 92.2 K
4 | rel_embed4    | Embedding                           | 92.2 K
----------------------------------------------------------------------
1.2 B     Trainable params
0         Non-trainable params
1.2 B     Total params
4,919.800 Total estimated model params size (MB)
Training: 0it [00:00, ?it/s]

======================================================================
Epoch:    0,
Epoch 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [45:18<00:00,  3.36it/s, loss=0.224]
Total time: 2718s, loss: 0.6596
Epoch 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [45:18<00:00,  3.36it/s, loss=0.224]

======================================================================
Epoch:    1,
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [45:54<00:00,  3.32it/s, loss=0.124]
Total time: 2754s, loss: 0.1775
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [45:54<00:00,  3.32it/s, loss=0.124]

======================================================================
Epoch:    2,
Epoch 2: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [45:39<00:00,  3.34it/s, loss=0.0929]
Training time: 2739s
Epoch 2: : 10592it [3:39:39,  1.24s/it, loss=0.0929]
Validation DataLoader 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:28:09<00:00,  7.28s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.351515  27.58%  38.52%  50.73%
head  0.081420   5.25%   8.81%  14.45%
mean  0.216467  16.41%  23.66%  32.59%

Ellipsis
Validation time: 10440s
Epoch 2: : 10592it [3:39:39,  1.24s/it, loss=0.0929]
Total time: 13219s, loss: 0.1198
Epoch 2: : 10592it [3:40:19,  1.25s/it, loss=0.0929]

======================================================================
Epoch:    3,
Epoch 3: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [45:45<00:00,  3.33it/s, loss=0.115]
Total time: 2745s, loss: 0.1065
Epoch 3: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [45:45<00:00,  3.33it/s, loss=0.115]

======================================================================
Epoch:    4,
Epoch 4: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [45:59<00:00,  3.31it/s, loss=0.0797]
Total time: 2759s, loss: 0.0881
Epoch 4: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [45:59<00:00,  3.31it/s, loss=0.0797]

======================================================================
Epoch:    5,
Epoch 5:  86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                 | 9138/10592 [45:59<07:19,  3.31it/s, loss=0.0729]
Training time: 2760s
Epoch 5: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:40:12<00:00,  1.25s/it, loss=0.0729]
Validation DataLoader 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:28:10<00:00,  7.28s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.369278  28.56%  40.81%  53.43%
head  0.103270   7.19%  10.82%  17.19%
mean  0.236274  17.87%  25.81%  35.31%

Ellipsis
Validation time: 10452s
Epoch 5: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:40:12<00:00,  1.25s/it, loss=0.0729]
Total time: 13252s, loss: 0.0740
Epoch 5: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:40:52<00:00,  1.25s/it, loss=0.0729]

======================================================================
Epoch:    6,
Epoch 6: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [46:35<00:00,  3.27it/s, loss=0.0629]
Total time: 2795s, loss: 0.0687
Epoch 6: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [46:35<00:00,  3.27it/s, loss=0.0629]

======================================================================
Epoch:    7,
Epoch 7: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [46:46<00:00,  3.26it/s, loss=0.0657]
Total time: 2806s, loss: 0.0653
Epoch 7: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [46:46<00:00,  3.26it/s, loss=0.0657]

======================================================================
Epoch:    8,
Epoch 8:  86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                 | 9138/10592 [46:47<07:26,  3.25it/s, loss=0.0641]
Training time: 2808s
Epoch 8: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:40:33<00:00,  1.25s/it, loss=0.0641]
Validation DataLoader 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:27:41<00:00,  7.24s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.410586  33.13%  44.90%  56.32%
head  0.120228   8.33%  13.07%  19.83%
mean  0.265407  20.73%  28.99%  38.08%

Ellipsis
Validation time: 10425s
Epoch 8: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:40:33<00:00,  1.25s/it, loss=0.0641]
Total time: 13275s, loss: 0.0626
Epoch 8: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:41:15<00:00,  1.25s/it, loss=0.0641]

======================================================================
Epoch:    9,
Epoch 9: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [44:56<00:00,  3.39it/s, loss=0.0601]
Total time: 2696s, loss: 0.0605
Epoch 9: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [44:56<00:00,  3.39it/s, loss=0.0601]

======================================================================
Epoch:   10,
Epoch 10: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [44:53<00:00,  3.39it/s, loss=0.0527]
Total time: 2693s, loss: 0.0588
Epoch 10: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [44:53<00:00,  3.39it/s, loss=0.0527]

======================================================================
Epoch:   11,
Epoch 11:  86%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                 | 9138/10592 [44:45<07:07,  3.40it/s, loss=0.0571]
Training time: 2685s
Epoch 11: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:37:46<00:00,  1.23s/it, loss=0.0571]
Validation DataLoader 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:27:35<00:00,  7.23s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.416463  33.60%  45.86%  57.23%
head  0.131447   9.41%  14.24%  20.75%
mean  0.273955  21.50%  30.05%  38.99%

Ellipsis
Validation time: 10380s
Epoch 11: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:37:46<00:00,  1.23s/it, loss=0.0571]
Total time: 13107s, loss: 0.0571
Epoch 11: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:38:27<00:00,  1.24s/it, loss=0.0571]

======================================================================
Epoch:   12,
Epoch 12: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [45:30<00:00,  3.35it/s, loss=0.0575]
Total time: 2730s, loss: 0.0560
Epoch 12: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [45:30<00:00,  3.35it/s, loss=0.0575]

======================================================================
Epoch:   13,
Epoch 13: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [45:30<00:00,  3.35it/s, loss=0.0569]
Total time: 2730s, loss: 0.0550
Epoch 13: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [45:30<00:00,  3.35it/s, loss=0.0569]

======================================================================
Epoch:   14,
Epoch 14:  86%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                 | 9138/10592 [45:40<07:15,  3.33it/s, loss=0.0572]
Training time: 2740s
Epoch 14: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:38:52<00:00,  1.24s/it, loss=0.0572]
Validation DataLoader 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:27:41<00:00,  7.24s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.418788  33.39%  46.40%  57.84%
head  0.129059   8.64%  14.50%  21.02%
mean  0.273923  21.01%  30.45%  39.43%

Ellipsis
Validation time: 10392s
Epoch 14: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:38:52<00:00,  1.24s/it, loss=0.0572]
Total time: 13172s, loss: 0.0544
Epoch 14: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:39:32<00:00,  1.24s/it, loss=0.0572]`Trainer.fit` stopped: `max_epochs=15` reached.
Epoch 14: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:39:32<00:00,  1.24s/it, loss=0.0572]
model_path: [./checkpoint/FB15k-237N-ko=mt5-large=1219.104313/FB15k-237N-ko-epoch=011-val_mrr=0.2740.ckpt]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Testing DataLoader 1: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 846/846 [1:38:48<00:00,  7.01s/it]


           mrr   hit@1   hit@3  hit@10
tail  0.415082  33.82%  45.33%  56.33%
head  0.136173  10.03%  14.48%  20.79%
mean  0.275627  21.92%  29.90%  38.56%

======================================================================
Epoch: test
Ellipsis
======================================================================
Testing DataLoader 1: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 846/846 [1:38:48<00:00,  7.01s/it]
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Runningstage.testing metric      DataLoader 0             DataLoader 1
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
         val_mrr            0.27562740445137024      0.27562740445137024
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
(KG-S2S) dlt@dl013:~/proj/KG-S2S$

