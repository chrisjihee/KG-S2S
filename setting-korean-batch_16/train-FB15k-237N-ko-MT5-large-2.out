#export CUDA_VISIBLE_DEVICES=1
#export CUDA_VISIBLE_DEVICES=5
#python3 main.py -dataset FB15k-237N-ko -lr 0.0005 -num_beams 40 -seq_dropout 0.2 -use_soft_prompt -use_rel_prompt_emb -src_descrip_max_length 200 -tgt_descrip_max_length 200 -pretrained_model google/mt5-base
python3 main.py -dataset FB15k-237N-ko \
                -lr 0.0005 \
                -precision bf16 \
                -epoch 15 \
                -batch_size 16 \
                -val_batch_size 8 \
                -num_beams 40 \
                -seq_dropout 0.2 \
                -use_soft_prompt \
                -use_rel_prompt_emb \
                -src_descrip_max_length 240 \
                -tgt_descrip_max_length 240 \
                -eval_tgt_max_length 90 \
                -pretrained_model google/mt5-large



(KG-S2S) dlt@dl013:~/proj/KG-S2S$ export CUDA_VISIBLE_DEVICES=1
(KG-S2S) dlt@dl013:~/proj/KG-S2S$ setting-korean-batch_16/train-FB15k-237N-ko-MT5-large-2.sh
Namespace(dataset_path='./data/processed', dataset='FB15k-237N-ko', model='T5Finetuner', precision='bf16', accelerator='gpu', seed=41504, num_workers=12, save_dir='./checkpoint/FB15k-237N-ko=mt5-large=1219.104311', pretrained_model='google/mt5-large', batch_size=16, val_batch_size=8, num_beams=40, num_beam_groups=1, src_max_length=512, train_tgt_max_length=512, eval_tgt_max_length=90, epochs=15, lr=0.0005, diversity_penalty=0.0, model_path='', optim='Adam', decoder='beam_search', log_text=False, use_prefix_search=False, src_descrip_max_length=240, tgt_descrip_max_length=240, use_soft_prompt=True, use_rel_prompt_emb=True, check_every_n_epochs=3, seq_dropout=0.2, temporal=False, n_ent=12068, n_rel=90, vocab_size=250112, model_dim=1024)
Global seed set to 41504
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.

----------------------------------------------------------------------------------
 - pretrained_model.model_type: mt5
 - tokenizer.additional_special_tokens: ['<extra_id_0>', '<extra_id_1>']
 - extra_id_0_tok_id: 250100
----------------------------------------------------------------------------------

tokenizing entities...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 12068/12068 [00:19<00:00, 617.02it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
datamodule construction done.

----------------------------------------------------------------------------------
 * pl.Trainer(accelerator=gpu, precision=bf16, max_epochs=15, every_n_epoch=3)
----------------------------------------------------------------------------------

Using bfloat16 Automatic Mixed Precision (AMP)
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
model construction done.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [1]

  | Name          | Type                                | Params
----------------------------------------------------------------------
0 | core_t5_model | ModifiedMT5ForConditionalGeneration | 1.2 B
1 | rel_embed1    | Embedding                           | 92.2 K
2 | rel_embed2    | Embedding                           | 92.2 K
3 | rel_embed3    | Embedding                           | 92.2 K
4 | rel_embed4    | Embedding                           | 92.2 K
----------------------------------------------------------------------
1.2 B     Trainable params
0         Non-trainable params
1.2 B     Total params
4,919.800 Total estimated model params size (MB)
Training: 0it [00:00, ?it/s]

======================================================================
Epoch:    0,
Epoch 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [46:21<00:00,  3.29it/s, loss=0.276]
Total time: 2781s, loss: 0.6390
Epoch 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [46:21<00:00,  3.29it/s, loss=0.276]

======================================================================
Epoch:    1,
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [47:01<00:00,  3.24it/s, loss=0.141]
Total time: 2821s, loss: 0.2178
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [47:01<00:00,  3.24it/s, loss=0.141]

======================================================================
Epoch:    2,
Epoch 2: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [46:47<00:00,  3.25it/s, loss=0.0944]
Training time: 2807s
Epoch 2: : 10592it [3:43:22,  1.27s/it, loss=0.0944]
Validation DataLoader 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:29:23<00:00,  7.38s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.402147  32.63%  43.94%  55.62%
head  0.111792   8.14%  11.70%  17.46%
mean  0.256970  20.39%  27.82%  36.54%

Ellipsis
Validation time: 10594s
Epoch 2: : 10592it [3:43:22,  1.27s/it, loss=0.0944]
Total time: 13440s, loss: 0.1246
Epoch 2: : 10592it [3:44:00,  1.27s/it, loss=0.0944]

======================================================================
Epoch:    3,
Epoch 3: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [46:58<00:00,  3.24it/s, loss=0.0851]
Total time: 2818s, loss: 0.0898
Epoch 3: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [46:58<00:00,  3.24it/s, loss=0.0851]

======================================================================
Epoch:    4,
Epoch 4: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [47:01<00:00,  3.24it/s, loss=0.0743]
Total time: 2821s, loss: 0.0780
Epoch 4: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [47:01<00:00,  3.24it/s, loss=0.0743]

======================================================================
Epoch:    5,
Epoch 5:  86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                 | 9138/10592 [47:05<07:29,  3.23it/s, loss=0.0673]
Training time: 2825s
Epoch 5: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:43:42<00:00,  1.27s/it, loss=0.0673]
Validation DataLoader 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:29:26<00:00,  7.38s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.416937  33.75%  45.64%  57.46%
head  0.132979   9.91%  13.95%  20.68%
mean  0.274958  21.83%  29.80%  39.07%

Ellipsis
Validation time: 10597s
Epoch 5: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:43:42<00:00,  1.27s/it, loss=0.0673]
Total time: 13460s, loss: 0.0689
Epoch 5: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:44:20<00:00,  1.27s/it, loss=0.0673]

======================================================================
Epoch:    6,
Epoch 6:  61%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                                Epoch 6:  61%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                                Epoch 6:  61%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                                Epoch 6:  61%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                                Epoch 6:  61%|██████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                                | 5603/9138 [28:56<18:15,  3.23it/s, loss=0.0693]Epoch 6:  61%|████████████████████████████████████████████████████████████████████████████Epoch 6:  63%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████Epoch 6:  63%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                             Epoch 6:  63%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                             Epoch 6:  63%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                            Epoch 6:  63%|█████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                              | 5737/9138 [29:37<17:33,  3.23it/s, loss=0.066]Epoch 6:  63%|████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                             Epoch 6: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [47:00<00:00,  3.24it/s, loss=0.0595]
Total time: 2820s, loss: 0.0644
Epoch 6: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [47:00<00:00,  3.24it/s, loss=0.0595]

======================================================================
Epoch:    7,
Epoch 7: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [47:10<00:00,  3.23it/s, loss=0.0631]
Total time: 2830s, loss: 0.0612
Epoch 7: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [47:10<00:00,  3.23it/s, loss=0.0631]

======================================================================
Epoch:    8,
Epoch 8:  86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                  | 9138/10592 [47:20<07:31,  3.22it/s, loss=0.06]
Training time: 2840s
Epoch 8: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:41:32<00:00,  1.25s/it, loss=0.06]
Validation DataLoader 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:27:58<00:00,  7.26s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.439459  35.87%  48.17%  59.56%
head  0.143435  10.39%  15.38%  22.31%
mean  0.291447  23.13%  31.77%  40.93%

Ellipsis
Validation time: 10452s
Epoch 8: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:41:32<00:00,  1.25s/it, loss=0.06]
Total time: 13331s, loss: 0.0587
Epoch 8: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:42:11<00:00,  1.26s/it, loss=0.06]

======================================================================
Epoch:    9,
Epoch 9: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [45:36<00:00,  3.34it/s, loss=0.0574]
Total time: 2736s, loss: 0.0564
Epoch 9: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [45:36<00:00,  3.34it/s, loss=0.0574]

======================================================================
Epoch:   10,
Epoch 10: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [45:33<00:00,  3.34it/s, loss=0.0491]
Total time: 2733s, loss: 0.0547
Epoch 10: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [45:33<00:00,  3.34it/s, loss=0.0491]

======================================================================
Epoch:   11,
Epoch 11:  86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                 | 9138/10592 [45:39<07:15,  3.34it/s, loss=0.053]
Training time: 2739s
Epoch 11: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:40:53<00:00,  1.25s/it, loss=0.053]
Validation DataLoader 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:28:41<00:00,  7.32s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.443666  36.40%  48.24%  60.18%
head  0.147089  10.75%  15.65%  22.86%
mean  0.295377  23.58%  31.95%  41.52%

Ellipsis
Validation time: 10514s
Epoch 11: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:40:53<00:00,  1.25s/it, loss=0.053]
Total time: 13292s, loss: 0.0529
Epoch 11: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:41:32<00:00,  1.25s/it, loss=0.053]

======================================================================
Epoch:   12,
Epoch 12: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [46:24<00:00,  3.28it/s, loss=0.0526]
Total time: 2784s, loss: 0.0515
Epoch 12: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [46:24<00:00,  3.28it/s, loss=0.0526]

======================================================================
Epoch:   13,
Epoch 13: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [46:25<00:00,  3.28it/s, loss=0.0514]
Total time: 2785s, loss: 0.0502
Epoch 13: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9138/9138 [46:25<00:00,  3.28it/s, loss=0.0514]

======================================================================
Epoch:   14,
Epoch 14:  86%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                 | 9138/10592 [46:32<07:24,  3.27it/s, loss=0.0526]
Training time: 2792s
Epoch 14: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:42:10<00:00,  1.26s/it, loss=0.0526]
Validation DataLoader 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:29:06<00:00,  7.35s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.443488  35.90%  48.89%  60.78%
head  0.146140  10.49%  15.53%  23.60%
mean  0.294814  23.20%  32.21%  42.19%

Ellipsis
Validation time: 10537s
Epoch 14: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:42:10<00:00,  1.26s/it, loss=0.0526]
Total time: 13369s, loss: 0.0491
Epoch 14: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:42:49<00:00,  1.26s/it, loss=0.0526]`Trainer.fit` stopped: `max_epochs=15` reached.
Epoch 14: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10592/10592 [3:42:49<00:00,  1.26s/it, loss=0.0526]
model_path: [./checkpoint/FB15k-237N-ko=mt5-large=1219.104311/FB15k-237N-ko-epoch=011-val_mrr=0.2954.ckpt]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [1]
Testing DataLoader 1: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 846/846 [1:40:34<00:00,  7.13s/it]


           mrr   hit@1   hit@3  hit@10
tail  0.442673  36.68%  48.05%  59.27%
head  0.153384  11.39%  16.33%  23.44%
mean  0.298029  24.03%  32.19%  41.36%

======================================================================
Epoch: test
Ellipsis
======================================================================
Testing DataLoader 1: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 846/846 [1:40:34<00:00,  7.13s/it]
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Runningstage.testing metric      DataLoader 0             DataLoader 1
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
         val_mrr            0.2980286478996277       0.2980286478996277
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
(KG-S2S) dlt@dl013:~/proj/KG-S2S$

