#export CUDA_VISIBLE_DEVICES=1
#export CUDA_VISIBLE_DEVICES=5
#python3 main.py -dataset FB15k-237N-ko -lr 0.0005 -num_beams 40 -seq_dropout 0.2 -use_soft_prompt -use_rel_prompt_emb -src_descrip_max_length 200 -tgt_descrip_max_length 200 -pretrained_model google/mt5-base
python3 main.py -dataset FB15k-237N-ko \
                -lr 0.0005 \
                -precision bf16 \
                -epoch 15 \
                -batch_size 4 \
                -val_batch_size 2 \
                -num_beams 40 \
                -seq_dropout 0.2 \
                -use_soft_prompt \
                -use_rel_prompt_emb \
                -src_descrip_max_length 200 \
                -tgt_descrip_max_length 200 \
                -eval_tgt_max_length 75 \
                -pretrained_model google/mt5-base



(KG-S2S) dlt@dl012:~/proj/KG-S2S$ export CUDA_VISIBLE_DEVICES=1
(KG-S2S) dlt@dl012:~/proj/KG-S2S$ setting-korean/train-FB15k-237N-ko-MT5-base-2.sh
Namespace(dataset_path='./data/processed', dataset='FB15k-237N-ko', model='T5Finetuner', precision='bf16', accelerator='gpu', seed=41504, num_workers=12, save_dir='./checkpoint/FB15k-237N-ko=mt5-base=1214.224132', pretrained_model='google/mt5-base', batch_size=4, val_batch_size=2, num_beams=40, num_beam_groups=1, src_max_length=512, train_tgt_max_length=512, eval_tgt_max_length=75, epochs=15, lr=0.0005, diversity_penalty=0.0, model_path='', optim='Adam', decoder='beam_search', log_text=False, use_prefix_search=False, src_descrip_max_length=200, tgt_descrip_max_length=200, use_soft_prompt=True, use_rel_prompt_emb=True, check_every_n_epochs=3, seq_dropout=0.2, temporal=False, n_ent=12068, n_rel=90, vocab_size=250112, model_dim=768)
Global seed set to 41504
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.

----------------------------------------------------------------------------------
 - pretrained_model.model_type: mt5
 - tokenizer.additional_special_tokens: ['<extra_id_0>', '<extra_id_1>']
 - extra_id_0_tok_id: 250100
----------------------------------------------------------------------------------

tokenizing entities...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 12068/12068 [00:20<00:00, 603.33it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
datamodule construction done.

----------------------------------------------------------------------------------
 * pl.Trainer(accelerator=gpu, precision=bf16, max_epochs=15, every_n_epoch=3)
----------------------------------------------------------------------------------

Using bfloat16 Automatic Mixed Precision (AMP)
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
model construction done.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [1]

  | Name          | Type                                | Params
----------------------------------------------------------------------
0 | core_t5_model | ModifiedMT5ForConditionalGeneration | 582 M
1 | rel_embed1    | Embedding                           | 69.1 K
2 | rel_embed2    | Embedding                           | 69.1 K
3 | rel_embed3    | Embedding                           | 69.1 K
4 | rel_embed4    | Embedding                           | 69.1 K
----------------------------------------------------------------------
582 M     Trainable params
0         Non-trainable params
582 M     Total params
2,330.711 Total estimated model params size (MB)
Training: 0it [00:00, ?it/s]

======================================================================
Epoch:    0,
Epoch 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [1:11:39<00:00,  8.50it/s, loss=0.343]
Total time: 4299s, loss: 0.8913
Epoch 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [1:11:39<00:00,  8.50it/s, loss=0.343]

======================================================================
Epoch:    1,
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [1:13:53<00:00,  8.24it/s, loss=0.283]
Total time: 4433s, loss: 0.3157
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [1:13:53<00:00,  8.24it/s, loss=0.283]

======================================================================
Epoch:    2,
Epoch 2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [1:12:04<00:00,  8.45it/s, loss=0.159]
Training time: 4324s
Epoch 2: : 42365it [3:47:30,  3.10it/s, loss=0.159]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [1:18:07<00:00,  1.61s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.215728  15.19%  23.57%  33.72%
head  0.038086   2.31%   4.18%   6.33%
mean  0.126907   8.75%  13.87%  20.02%

Ellipsis
Validation time: 9325s
Epoch 2: : 42365it [3:47:30,  3.10it/s, loss=0.159]
Total time: 13666s, loss: 0.2065
Epoch 2: : 42365it [3:47:46,  3.10it/s, loss=0.159]

======================================================================
Epoch:    3,
Epoch 3: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [1:11:51<00:00,  8.48it/s, loss=0.212]
Total time: 4311s, loss: 0.1700
Epoch 3: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [1:11:51<00:00,  8.48it/s, loss=0.212]

======================================================================
Epoch:    4,
Epoch 4: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [1:11:07<00:00,  8.56it/s, loss=0.165]
Total time: 4267s, loss: 0.1517
Epoch 4: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [1:11:07<00:00,  8.56it/s, loss=0.165]

======================================================================
Epoch:    5,
Epoch 5:  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                 | 36551/42365 [1:10:37<11:13,  8.63it/s, loss=0.166]
Training time: 4237s
Epoch 5: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [3:46:09<00:00,  3.12it/s, loss=0.166]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [1:17:53<00:00,  1.61s/it]

           mrr  hit@1   hit@3  hit@10
tail  0.141780  9.13%  14.52%  24.12%
head  0.027688  1.46%   2.99%   4.73%
mean  0.084734  5.30%   8.76%  14.42%

Ellipsis
Validation time: 9332s
Epoch 5: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [3:46:09<00:00,  3.12it/s, loss=0.166]
Total time: 13587s, loss: 0.1484
Epoch 5: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [3:46:27<00:00,  3.12it/s, loss=0.166]

======================================================================
Epoch:    6,
Epoch 6: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [1:12:27<00:00,  8.41it/s, loss=0.141]
Total time: 4347s, loss: 0.1400
Epoch 6: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [1:12:27<00:00,  8.41it/s, loss=0.141]

======================================================================
Epoch:    7,
Epoch 7: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [1:12:52<00:00,  8.36it/s, loss=0.123]
Total time: 4372s, loss: 0.1341
Epoch 7: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [1:12:52<00:00,  8.36it/s, loss=0.123]

======================================================================
Epoch:    8,
Epoch 8:  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                 | 36551/42365 [1:13:10<11:38,  8.33it/s, loss=0.138]
Training time: 4390s
Epoch 8: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [3:52:12<00:00,  3.04it/s, loss=0.138]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [1:20:08<00:00,  1.65s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.151726  11.22%  14.85%  23.86%
head  0.029098   1.88%   3.03%   4.49%
mean  0.090412   6.55%   8.94%  14.18%

Ellipsis
Validation time: 9541s
Epoch 8: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [3:52:12<00:00,  3.04it/s, loss=0.138]
Total time: 13951s, loss: 0.1338
Epoch 8: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [3:52:31<00:00,  3.04it/s, loss=0.138]

======================================================================
Epoch:    9,
Epoch 9: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [1:13:04<00:00,  8.34it/s, loss=0.119]
Total time: 4384s, loss: 0.1310
Epoch 9: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [1:13:04<00:00,  8.34it/s, loss=0.119]

======================================================================
Epoch:   10,
Epoch 10: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [1:11:54<00:00,  8.47it/s, loss=0.114]
Total time: 4314s, loss: 0.1282
Epoch 10: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [1:11:54<00:00,  8.47it/s, loss=0.114]

======================================================================
Epoch:   11,
Epoch 11:  86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                 | 36551/42365 [1:12:32<11:32,  8.40it/s, loss=0.112]
Training time: 4352s
Epoch 11: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [3:55:47<00:00,  2.99it/s, loss=0.112]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [1:22:32<00:00,  1.70s/it]

           mrr  hit@1   hit@3  hit@10
tail  0.137068  6.21%  18.18%  26.01%
head  0.019115  1.29%   1.82%   2.63%
mean  0.078092  3.75%  10.00%  14.32%

Ellipsis
Validation time: 9795s
Epoch 11: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [3:55:47<00:00,  2.99it/s, loss=0.112]
Total time: 14165s, loss: 0.1285
Epoch 11: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [3:56:05<00:00,  2.99it/s, loss=0.112]

======================================================================
Epoch:   12,
Epoch 12: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [1:12:24<00:00,  8.41it/s, loss=0.124]
Total time: 4344s, loss: 0.1276
Epoch 12: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [1:12:24<00:00,  8.41it/s, loss=0.124]

======================================================================
Epoch:   13,
Epoch 13: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [1:12:32<00:00,  8.40it/s, loss=0.128]
Total time: 4352s, loss: 0.1250
Epoch 13: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [1:12:32<00:00,  8.40it/s, loss=0.128]

======================================================================
Epoch:   14,
Epoch 14:  86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                 | 36551/42365 [1:12:46<11:34,  8.37it/s, loss=0.124]
Training time: 4366s
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [3:52:04<00:00,  3.04it/s, loss=0.124]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [1:19:46<00:00,  1.65s/it]

           mrr  hit@1   hit@3  hit@10
tail  0.109365  5.71%  11.78%  19.96%
head  0.022417  1.34%   2.27%   3.58%
mean  0.065891  3.53%   7.03%  11.77%

Ellipsis
Validation time: 9557s
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [3:52:04<00:00,  3.04it/s, loss=0.124]
Total time: 13942s, loss: 0.1228
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [3:52:22<00:00,  3.04it/s, loss=0.124]`Trainer.fit` stopped: `max_epochs=15` reached.
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [3:52:22<00:00,  3.04it/s, loss=0.124]
model_path: [./checkpoint/FB15k-237N-ko=mt5-base=1214.224132/FB15k-237N-ko-epoch=002-val_mrr=0.1269.ckpt]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [1]
Testing DataLoader 1: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3381/3381 [1:26:31<00:00,  1.54s/it]


           mrr   hit@1   hit@3  hit@10
tail  0.217601  15.41%  24.08%  33.44%
head  0.038218   2.29%   4.14%   6.43%
mean  0.127910   8.85%  14.11%  19.93%

======================================================================
Epoch: test
Ellipsis
======================================================================
Testing DataLoader 1: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3381/3381 [1:26:31<00:00,  1.54s/it]
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Runningstage.testing metric      DataLoader 0             DataLoader 1
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
         val_mrr            0.1279095858335495       0.1279095858335495
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
(KG-S2S) dlt@dl012:~/proj/KG-S2S$

