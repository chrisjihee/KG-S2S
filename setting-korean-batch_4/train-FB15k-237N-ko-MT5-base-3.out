#export CUDA_VISIBLE_DEVICES=0
#export CUDA_VISIBLE_DEVICES=4
#python3 main.py -dataset FB15k-237N-ko -lr 0.001 -num_beams 40 -seq_dropout 0.2 -use_soft_prompt -use_rel_prompt_emb -src_descrip_max_length 200 -tgt_descrip_max_length 200 -pretrained_model google/mt5-base
python3 main.py -dataset FB15k-237N-ko \
                -lr 0.001 \
                -precision 32 \
                -epoch 15 \
                -batch_size 4 \
                -val_batch_size 2 \
                -num_beams 40 \
                -seq_dropout 0.2 \
                -use_soft_prompt \
                -use_rel_prompt_emb \
                -src_descrip_max_length 200 \
                -tgt_descrip_max_length 200 \
                -eval_tgt_max_length 75 \
                -pretrained_model google/mt5-base



(KG-S2S) chris@chris137:/dat/proj/KG-S2S$ export CUDA_VISIBLE_DEVICES=0
(KG-S2S) chris@chris137:/dat/proj/KG-S2S$ setting-korean/train-FB15k-237N-ko-MT5-base-3.sh
Namespace(dataset_path='./data/processed', dataset='FB15k-237N-ko', model='T5Finetuner', precision='32', accelerator='gpu', seed=41504, num_workers=12, save_dir='./checkpoint/FB15k-237N-ko=mt5-base=1214.222355', pretrained_model='google/mt5-base', batch_size=4, val_batch_size=2, num_beams=40, num_beam_groups=1, src_max_length=512, train_tgt_max_length=512, eval_tgt_max_length=75, epochs=15, lr=0.001, diversity_penalty=0.0, model_path='', optim='Adam', decoder='beam_search', log_text=False, use_prefix_search=False, src_descrip_max_length=200, tgt_descrip_max_length=200, use_soft_prompt=True, use_rel_prompt_emb=True, check_every_n_epochs=3, seq_dropout=0.2, temporal=False, n_ent=12068, n_rel=90, vocab_size=250112, model_dim=768)
Global seed set to 41504
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.

----------------------------------------------------------------------------------
 - pretrained_model.model_type: mt5
 - tokenizer.additional_special_tokens: ['<extra_id_0>', '<extra_id_1>']
 - extra_id_0_tok_id: 250100
----------------------------------------------------------------------------------

tokenizing entities...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 12068/12068 [00:28<00:00, 429.31it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
datamodule construction done.

----------------------------------------------------------------------------------
 * pl.Trainer(accelerator=gpu, precision=32, max_epochs=15, every_n_epoch=3)
----------------------------------------------------------------------------------

GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
model construction done.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]

  | Name          | Type                                | Params
----------------------------------------------------------------------
0 | core_t5_model | ModifiedMT5ForConditionalGeneration | 582 M
1 | rel_embed1    | Embedding                           | 69.1 K
2 | rel_embed2    | Embedding                           | 69.1 K
3 | rel_embed3    | Embedding                           | 69.1 K
4 | rel_embed4    | Embedding                           | 69.1 K
----------------------------------------------------------------------
582 M     Trainable params
0         Non-trainable params
582 M     Total params
2,330.711 Total estimated model params size (MB)
Training: 0it [00:00, ?it/s]

======================================================================
Epoch:    0,
Epoch 0:  29%|█████████████████████████████████████████████████████████████████████▊                                                                                                                                                  Epoch 0:  29%|█████████████████████████████████████████████████████████████████████▊                                                                                                                                                  Epoch 0:  29%|█████████████████████████████████████████████████████████████████████▊                                                                                                                                                  Epoch 0:  29%|█████████████████████████████████████████████████████████████████████▊                                                                                                                                                  Epoch 0:  29%|█████████████████████████████████████████████████████████████████████▊                                                                                                                                                  Epoch 0:  29%|█████████████████████████████████████████████████████████████████████▊                                                                                                                                                  Epoch 0:  29%|██████████████████████████████████████████████▉                                                                                                             Epoch 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:04:43<00:00,  4.88it/s, loss=0.306]
Total time: 7483s, loss: 0.7982
Epoch 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:04:43<00:00,  4.88it/s, loss=0.306]

======================================================================
Epoch:    1,
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:04:54<00:00,  4.88it/s, loss=0.259]
Total time: 7494s, loss: 0.2833
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:04:54<00:00,  4.88it/s, loss=0.259]

======================================================================
Epoch:    2,
Epoch 2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:04:05<00:00,  4.91it/s, loss=0.153]
Training time: 7445s
Epoch 2: : 42365it [5:21:00,  2.20it/s, loss=0.153]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [1:37:47<00:00,  2.02s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.262024  18.08%  30.10%  40.00%
head  0.050404   3.37%   5.16%   8.15%
mean  0.156214  10.73%  17.63%  24.08%

Ellipsis
Validation time: 11814s
Epoch 2: : 42365it [5:21:00,  2.20it/s, loss=0.153]
Total time: 19288s, loss: 0.2276
Epoch 2: : 42365it [5:21:28,  2.20it/s, loss=0.153]

======================================================================
Epoch:    3,
Epoch 3: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:03:21<00:00,  4.94it/s, loss=0.204]
Total time: 7401s, loss: 0.1706
Epoch 3: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:03:21<00:00,  4.94it/s, loss=0.204]

======================================================================
Epoch:    4,
Epoch 4: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:02:44<00:00,  4.96it/s, loss=0.17]
Total time: 7364s, loss: 0.1466
Epoch 4: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:02:44<00:00,  4.96it/s, loss=0.17]

======================================================================
Epoch:    5,
Epoch 5:  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                 | 36551/42365 [2:04:00<19:43,  4.91it/s, loss=0.148]
Training time: 7440s
Epoch 5: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [5:25:04<00:00,  2.17it/s, loss=0.148]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [1:41:47<00:00,  2.10s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.282799  19.59%  32.36%  44.97%
head  0.060458   3.77%   6.28%  10.44%
mean  0.171628  11.68%  19.32%  27.71%

Ellipsis
Validation time: 12064s
Epoch 5: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [5:25:04<00:00,  2.17it/s, loss=0.148]
Total time: 19532s, loss: 0.1355
Epoch 5: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [5:25:32<00:00,  2.17it/s, loss=0.148]

======================================================================
Epoch:    6,
Epoch 6: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:01:55<00:00,  5.00it/s, loss=0.128]
Total time: 7315s, loss: 0.1284
Epoch 6: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:01:55<00:00,  5.00it/s, loss=0.128]

======================================================================
Epoch:    7,
Epoch 7: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:04:19<00:00,  4.90it/s, loss=0.109]
Total time: 7459s, loss: 0.1225
Epoch 7: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:04:19<00:00,  4.90it/s, loss=0.109]

======================================================================
Epoch:    8,
Epoch 8:  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                 | 36551/42365 [2:04:09<19:44,  4.91it/s, loss=0.119]
Training time: 7449s
Epoch 8: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [5:30:38<00:00,  2.14it/s, loss=0.119]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [1:39:57<00:00,  2.06s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.310654  23.36%  34.59%  46.43%
head  0.067921   4.18%   7.53%  11.20%
mean  0.189288  13.77%  21.06%  28.81%

Ellipsis
Validation time: 12388s
Epoch 8: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [5:30:38<00:00,  2.14it/s, loss=0.119]
Total time: 19870s, loss: 0.1177
Epoch 8: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [5:31:10<00:00,  2.13it/s, loss=0.119]

======================================================================
Epoch:    9,
Epoch 9: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:02:58<00:00,  4.95it/s, loss=0.105]
Total time: 7378s, loss: 0.1156
Epoch 9: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:02:58<00:00,  4.95it/s, loss=0.105]

======================================================================
Epoch:   10,
Epoch 10: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:04:09<00:00,  4.91it/s, loss=0.0986]
Total time: 7449s, loss: 0.1120
Epoch 10: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:04:09<00:00,  4.91it/s, loss=0.0986]

======================================================================
Epoch:   11,
Epoch 11:  86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                 | 36551/42365 [2:02:49<19:32,  4.96it/s, loss=0.089]
Training time: 7369s
Epoch 11: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [5:21:53<00:00,  2.19it/s, loss=0.089]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [1:42:00<00:00,  2.11s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.312482  23.81%  34.39%  45.24%
head  0.066618   4.42%   6.61%  11.06%
mean  0.189550  14.11%  20.50%  28.15%

Ellipsis
Validation time: 11944s
Epoch 11: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [5:21:53<00:00,  2.19it/s, loss=0.089]
Total time: 19342s, loss: 0.1093
Epoch 11: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [5:22:22<00:00,  2.19it/s, loss=0.089]

======================================================================
Epoch:   12,
Epoch 12: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:02:55<00:00,  4.96it/s, loss=0.111]
Total time: 7375s, loss: 0.1068
Epoch 12: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:02:55<00:00,  4.96it/s, loss=0.111]

======================================================================
Epoch:   13,
Epoch 13: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:02:47<00:00,  4.96it/s, loss=0.0983]
Total time: 7367s, loss: 0.1063
Epoch 13: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:02:47<00:00,  4.96it/s, loss=0.0983]

======================================================================
Epoch:   14,
Epoch 14:  86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                 | 36551/42365 [2:02:25<19:28,  4.98it/s, loss=0.106]
Training time: 7345s
Epoch 14:  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                    | 38846/42365 [3:21:53<18:17,  3.21it/s, loss=0.106]
Epoch 14:  92%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                    | 38847/42365 [3:21:55<18:17,  3.21it/s, loss=0.106]
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [5:22:45<00:00,  2.19it/s, loss=0.106]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [1:38:59<00:00,  2.04s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.296969  21.93%  32.94%  44.33%
head  0.061800   3.66%   6.28%  11.41%
mean  0.179384  12.80%  19.61%  27.87%

Ellipsis
Validation time: 12019s
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [5:22:45<00:00,  2.19it/s, loss=0.106]
Total time: 19394s, loss: 0.1040
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [5:23:14<00:00,  2.18it/s, loss=0.106]`Trainer.fit` stopped: `max_epochs=15` reached.
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [5:23:14<00:00,  2.18it/s, loss=0.106]
model_path: [./checkpoint/FB15k-237N-ko=mt5-base=1214.222355/FB15k-237N-ko-epoch=011-val_mrr=0.1895.ckpt]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Testing DataLoader 1: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3381/3381 [1:45:55<00:00,  1.88s/it]


           mrr   hit@1   hit@3  hit@10
tail  0.302079  22.43%  33.69%  45.18%
head  0.065543   4.07%   6.95%  11.39%
mean  0.183811  13.25%  20.32%  28.28%

======================================================================
Epoch: test
Ellipsis
======================================================================
Testing DataLoader 1: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3381/3381 [1:45:55<00:00,  1.88s/it]
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Runningstage.testing metric      DataLoader 0             DataLoader 1
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
         val_mrr            0.18381063640117645      0.18381063640117645
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
(KG-S2S) chris@chris137:/dat/proj/KG-S2S$ aQ

