(KG-S2S) dlt@dl012:~/proj/KG-S2S$ export CUDA_VISIBLE_DEVICES=2
(KG-S2S) dlt@dl012:~/proj/KG-S2S$ setting-korean/train-FB15k-237N-ko-KeT5-1.sh
Namespace(dataset_path='./data/processed', dataset='FB15k-237N-ko', model='T5Finetuner', strategy='auto', precision='bf16', accelerator='gpu', seed=41504, num_workers=4, save_dir='./checkpoint/FB15k-237N-ko-2023-12-12 19:34:46.236526', pretrained_model='KETI-AIR/ke-t5-base-ko', batch_size=16, val_batch_size=16, num_beams=40, num_beam_groups=1, src_max_length=512, train_tgt_max_length=512, eval_tgt_max_length=90, epochs=3, lr=0.001, diversity_penalty=0.0, model_path='', optim='Adam', decoder='beam_search', log_text=False, use_prefix_search=False, src_descrip_max_length=240, tgt_descrip_max_length=240, use_soft_prompt=True, use_rel_prompt_emb=True, skip_n_val_epoch=0, seq_dropout=0.2, temporal=False, n_ent=12068, n_rel=90, vocab_size=64128, model_dim=768)
Global seed set to 41504

----------------------------------------------------------------------------------
 - pretrained_model.model_type: t5
 - tokenizer.additional_special_tokens: ['<extra_id_0>', '<extra_id_1>', '<extra_id_2>', '<extra_id_3>', '<extra_id_4>', '<extra_id_5>', '<extra_id_6>', '<extra_id_7>', '<extra_id_8>', '<extra_id_9>', '<extra_id_10>', '<extra_id_11>', '<extra_id_12>', '<extra_id_13>', '<extra_id_14>', '<extra_id_15>', '<extra_id_16>', '<extra_id_17>', '<extra_id_18>', '<extra_id_19>', '<extra_id_20>', '<extra_id_21>', '<extra_id_22>', '<extra_id_23>', '<extra_id_24>', '<extra_id_25>', '<extra_id_26>', '<extra_id_27>', '<extra_id_28>', '<extra_id_29>', '<extra_id_30>', '<extra_id_31>', '<extra_id_32>', '<extra_id_33>', '<extra_id_34>', '<extra_id_35>', '<extra_id_36>', '<extra_id_37>', '<extra_id_38>', '<extra_id_39>', '<extra_id_40>', '<extra_id_41>', '<extra_id_42>', '<extra_id_43>', '<extra_id_44>', '<extra_id_45>', '<extra_id_46>', '<extra_id_47>', '<extra_id_48>', '<extra_id_49>', '<extra_id_50>', '<extra_id_51>', '<extra_id_52>', '<extra_id_53>', '<extra_id_54>', '<extra_id_55>', '<extra_id_56>', '<extra_id_57>', '<extra_id_58>', '<extra_id_59>', '<extra_id_60>', '<extra_id_61>', '<extra_id_62>', '<extra_id_63>', '<extra_id_64>', '<extra_id_65>', '<extra_id_66>', '<extra_id_67>', '<extra_id_68>', '<extra_id_69>', '<extra_id_70>', '<extra_id_71>', '<extra_id_72>', '<extra_id_73>', '<extra_id_74>', '<extra_id_75>', '<extra_id_76>', '<extra_id_77>', '<extra_id_78>', '<extra_id_79>', '<extra_id_80>', '<extra_id_81>', '<extra_id_82>', '<extra_id_83>', '<extra_id_84>', '<extra_id_85>', '<extra_id_86>', '<extra_id_87>', '<extra_id_88>', '<extra_id_89>', '<extra_id_90>', '<extra_id_91>', '<extra_id_92>', '<extra_id_93>', '<extra_id_94>', '<extra_id_95>', '<extra_id_96>', '<extra_id_97>', '<extra_id_98>', '<extra_id_99>']
 - extra_id_0_tok_id: 64099
----------------------------------------------------------------------------------

tokenizing entities...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 12068/12068 [00:21<00:00, 567.36it/s]
datamodule construction done.

----------------------------------------------------------------------------------
 * pl.Trainer(accelerator=gpu, precision=bf16, strategy=auto)
----------------------------------------------------------------------------------

Using bfloat16 Automatic Mixed Precision (AMP)
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
model construction done.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [2]

  | Name          | Type                               | Params
---------------------------------------------------------------------
0 | core_t5_model | ModifiedT5ForConditionalGeneration | 247 M
1 | rel_embed1    | Embedding                          | 69.1 K
2 | rel_embed2    | Embedding                          | 69.1 K
3 | rel_embed3    | Embedding                          | 69.1 K
4 | rel_embed4    | Embedding                          | 69.1 K
---------------------------------------------------------------------
247 M     Trainable params
0         Non-trainable params
247 M     Total params
991.024   Total estimated model params size (MB)
Training: 0it [00:00, ?it/s]Epoch:    0,
Epoch 0:  93%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                  | 9138/9866 [17:08<01:21,  8.89it/s, loss=0.575]Training time: 1028s
Epoch 0: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [1:38:56<00:00,  1.66it/s, loss=0.575]
                   mrr           mr   hit@1   hit@3  hit@10█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 364/364 [40:56<00:00,  6.75s/it]
tail ranking  0.208353  3507.201273  15.71%  21.80%  31.96%
head ranking  0.040329  5263.309823   2.29%   4.13%   8.52%
mean ranking  0.124341  4385.255548   9.00%  12.96%  20.24%
Ellipsis
Validation time: 4908s
Epoch 0: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [1:38:56<00:00,  1.66it/s, loss=0.575]
Total time: 5936s, loss: 1.0449
--------------------------------------------------
Epoch 0: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [1:38:56<00:00,  1.66it/s, loss=0.575]Epoch:    1,
Epoch 1:  93%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                  | 9138/9866 [16:45<01:20,  9.09it/s, loss=0.291]Training time: 1005s
Epoch 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [1:38:06<00:00,  1.68it/s, loss=0.291]
                   mrr           mr   hit@1   hit@3  hit@10█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 364/364 [41:00<00:00,  6.76s/it]
tail ranking  0.354475  2447.964906  27.27%  39.70%  51.54%
head ranking  0.084831  4888.968519   5.73%   9.22%  14.47%
mean ranking  0.219653  3668.466713  16.50%  24.46%  33.00%
Ellipsis
Validation time: 4881s
Epoch 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [1:38:06<00:00,  1.68it/s, loss=0.291]
Total time: 5886s, loss: 0.4122
--------------------------------------------------
Epoch 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [1:38:06<00:00,  1.68it/s, loss=0.291]Epoch:    2,
Epoch 2:  93%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                  | 9138/9866 [15:26<01:13,  9.87it/s, loss=0.251]Training time:  926s
Epoch 2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [1:34:58<00:00,  1.73it/s, loss=0.251]
                   mrr           mr   hit@1   hit@3  hit@10█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 364/364 [39:52<00:00,  6.57s/it]
tail ranking  0.364743  2371.321865  28.56%  40.48%  52.92%
head ranking  0.092342  4756.369689   6.47%   9.67%  15.24%
mean ranking  0.228542  3563.845777  17.51%  25.07%  34.08%
Ellipsis
Validation time: 4772s
Epoch 2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [1:34:58<00:00,  1.73it/s, loss=0.251]
Total time: 5698s, loss: 0.2410
--------------------------------------------------
Epoch 2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [1:34:58<00:00,  1.73it/s, loss=0.251]`Trainer.fit` stopped: `max_epochs=3` reached.
Epoch 2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [1:35:09<00:00,  1.73it/s, loss=0.251]
model_path: [./checkpoint/FB15k-237N-ko-2023-12-12 19:34:46.236526/FB15k-237N-ko-epoch=002-val_mrr=0.2285.ckpt]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [2]
Testing DataLoader 1: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 423/423 [44:02<00:00,  6.25s/it]
                   mrr           mr   hit@1   hit@3  hit@10
tail ranking  0.355008  2407.569062  27.80%  38.89%  51.60%
head ranking  0.097621  4737.882283   6.80%  10.68%  16.12%
mean ranking  0.226314  3572.725673  17.30%  24.79%  33.86%

==================================================
Epoch: test
Ellipsis
==================================================
Testing DataLoader 1: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 423/423 [44:02<00:00,  6.25s/it]
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Runningstage.testing metric      DataLoader 0             DataLoader 1
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
         val_mrr            0.2263144701719284       0.2263144701719284
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
(KG-S2S) dlt@dl012:~/proj/KG-S2S$

