(KG-S2S) dlt@dl012:~/proj/KG-S2S$ export CUDA_VISIBLE_DEVICES=4
(KG-S2S) dlt@dl012:~/proj/KG-S2S$ setting-korean/train-FB15k-237N-ko-MT5.sh
Namespace(dataset_path='./data/processed', dataset='FB15k-237N-ko', model='T5Finetuner', strategy='auto', precision='bf16', accelerator='gpu', seed=41504, num_workers=4, save_dir='./checkpoint/FB15k-237N-ko-2023-12-12 01:28:28.476108', pretrained_model='google/mt5-base', batch_size=16, val_batch_size=16, num_beams=40, num_beam_groups=1, src_max_length=512, train_tgt_max_length=512, eval_tgt_max_length=90, epochs=3, lr=0.001, diversity_penalty=0.0, model_path='', optim='Adam', decoder='beam_search', log_text=False, use_prefix_search=False, src_descrip_max_length=240, tgt_descrip_max_length=240, use_soft_prompt=True, use_rel_prompt_emb=True, skip_n_val_epoch=0, seq_dropout=0.2, temporal=False, n_ent=12068, n_rel=90, vocab_size=250112, model_dim=768)
Global seed set to 41504
Downloading: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 376/376 [00:00<00:00, 2.07MB/s]
Downloading: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4.11M/4.11M [00:00<00:00, 10.5MB/s]
Downloading: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 65.0/65.0 [00:00<00:00, 477kB/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
tokenizing entities...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 12068/12068 [00:31<00:00, 378.45it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
datamodule construction done.

----------------------------------------------------------------------------------
 * pl.Trainer(accelerator=gpu, precision=bf16, strategy=auto)
----------------------------------------------------------------------------------

Using bfloat16 Automatic Mixed Precision (AMP)
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
model construction done.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [4]

  | Name          | Type                                | Params
----------------------------------------------------------------------
0 | core_t5_model | ModifiedMT5ForConditionalGeneration | 582 M
1 | rel_embed1    | Embedding                           | 69.1 K
2 | rel_embed2    | Embedding                           | 69.1 K
3 | rel_embed3    | Embedding                           | 69.1 K
4 | rel_embed4    | Embedding                           | 69.1 K
----------------------------------------------------------------------
582 M     Trainable params
0         Non-trainable params
582 M     Total params
2,330.711 Total estimated model params size (MB)
Training: 0it [00:00, ?it/s]Epoch:    0,
Epoch 0:  93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 9138/9866 [28:36<02:16,  5.32it/s, loss=0.341]Training time: 1716s
Epoch 0: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [2:34:08<00:00,  1.07it/s, loss=0.341]
                   mrr           mr   hit@1   hit@3  hit@10███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 364/364 [1:03:01<00:00, 10.39s/it]
tail ranking  0.235140  3076.339756  16.76%  25.82%  37.93%
head ranking  0.041929  5199.831068   2.53%   4.28%   7.43%
mean ranking  0.138534  4138.085412   9.64%  15.05%  22.68%
Ellipsis
Validation time: 7531s
Epoch 0: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [2:34:08<00:00,  1.07it/s, loss=0.341]
Total time: 9248s, loss: 0.6280
--------------------------------------------------
Epoch 0: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [2:34:08<00:00,  1.07it/s, loss=0.341]Epoch:    1,
Epoch 1:  93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 9138/9866 [28:33<02:16,  5.33it/s, loss=1.11]Training time: 1713s
Epoch 1: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [2:35:38<00:00,  1.06it/s, loss=1.11]
                   mrr           mr  hit@1  hit@3  hit@10█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 364/364 [1:04:02<00:00, 10.56s/it]
tail ranking  0.074422  5156.260967  4.59%  6.78%  15.95%
head ranking  0.015395  5979.229658  1.29%  1.70%   1.81%
mean ranking  0.044909  5567.745312  2.94%  4.24%   8.88%
Ellipsis
Validation time: 7625s
Epoch 1: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [2:35:38<00:00,  1.06it/s, loss=1.11]
Total time: 9338s, loss: 1.7213
--------------------------------------------------
Epoch 1: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [2:35:38<00:00,  1.06it/s, loss=1.11]Epoch:    2,
Epoch 2:  93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 9138/9866 [29:15<02:19,  5.20it/s, loss=0.267]Training time: 1756s
Epoch 2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [2:36:24<00:00,  1.05it/s, loss=0.267]
                   mrr           mr  hit@1  hit@3  hit@10█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 364/364 [1:04:05<00:00, 10.57s/it]
tail ranking  0.079826  4344.621366  4.59%  5.69%  17.75%
head ranking  0.016359  5829.062618  1.29%  1.58%   2.06%
mean ranking  0.048093  5086.841992  2.94%  3.64%   9.91%
Ellipsis
Validation time: 7628s
Epoch 2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [2:36:24<00:00,  1.05it/s, loss=0.267]
Total time: 9384s, loss: 0.4311
--------------------------------------------------
Epoch 2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [2:36:24<00:00,  1.05it/s, loss=0.267]`Trainer.fit` stopped: `max_epochs=3` reached.
Epoch 2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [2:36:24<00:00,  1.05it/s, loss=0.267]
model_path: [./checkpoint/FB15k-237N-ko-2023-12-12 01:28:28.476108/FB15k-237N-ko-epoch=000-val_mrr=0.1385.ckpt]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [4]
Testing DataLoader 1: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 423/423 [1:06:52<00:00,  9.48s/it]
                   mrr           mr   hit@1   hit@3  hit@10
tail ranking  0.237896  3109.602632  17.29%  25.82%  37.83%
head ranking  0.040179  5292.193730   2.43%   3.98%   7.44%
mean ranking  0.139038  4200.898181   9.86%  14.90%  22.63%

==================================================
Epoch: test
Ellipsis
==================================================
Testing DataLoader 1: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 423/423 [1:06:52<00:00,  9.48s/it]
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Runningstage.testing metric      DataLoader 0             DataLoader 1
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
         val_mrr            0.1390375941991806       0.1390375941991806
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
(KG-S2S) dlt@dl012:~/proj/KG-S2S$

