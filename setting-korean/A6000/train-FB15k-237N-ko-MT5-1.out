(KG-S2S) chrisjihee@ptlm3:~/proj/KG-S2S$ setting-korean/train-FB15k-237N-ko-MT5.sh
Namespace(dataset_path='./data/processed', dataset='FB15k-237N-ko', model='T5Finetuner', strategy='auto', precision='bf16', accelerator='gpu', seed=41504, num_workers=4, save_dir='./checkpoint/FB15k-237N-ko-2023-12-12 01:23:46.407204', pretrained_model='google/mt5-base', batch_size=16, val_batch_size=16, num_beams=40, num_beam_groups=1, src_max_length=512, train_tgt_max_length=512, eval_tgt_max_length=90, epochs=3, lr=0.001, diversity_penalty=0.0, model_path='', optim='Adam', decoder='beam_search', log_text=False, use_prefix_search=False, src_descrip_max_length=240, tgt_descrip_max_length=240, use_soft_prompt=True, use_rel_prompt_emb=True, skip_n_val_epoch=0, seq_dropout=0.2, temporal=False, n_ent=12068, n_rel=90, vocab_size=250112, model_dim=768)
Global seed set to 41504
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
tokenizing entities...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 12068/12068 [00:25<00:00, 466.27it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
datamodule construction done.

----------------------------------------------------------------------------------
 * pl.Trainer(accelerator=gpu, precision=bf16, strategy=auto)
----------------------------------------------------------------------------------

Using bfloat16 Automatic Mixed Precision (AMP)
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
model construction done.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]

  | Name          | Type                                | Params
----------------------------------------------------------------------
0 | core_t5_model | ModifiedMT5ForConditionalGeneration | 582 M
1 | rel_embed1    | Embedding                           | 69.1 K
2 | rel_embed2    | Embedding                           | 69.1 K
3 | rel_embed3    | Embedding                           | 69.1 K
4 | rel_embed4    | Embedding                           | 69.1 K
----------------------------------------------------------------------
582 M     Trainable params
0         Non-trainable params
582 M     Total params
2,330.711 Total estimated model params size (MB)
Training: 0it [00:00, ?it/s]Epoch:    0,
Epoch 0:  93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 9138/9866 [35:39<02:50,  4.27it/s, loss=0.327]Training time: 2139s
Epoch 0: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [2:22:10<00:00,  1.16it/s, loss=0.327]
                   mrr           mr   hit@1   hit@3  hit@10█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 364/364 [53:37<00:00,  8.84s/it]
tail ranking  0.295014  2890.252537  22.47%  32.58%  44.64%
head ranking  0.061606  5136.312059   4.30%   6.47%  10.37%
mean ranking  0.178310  4013.282298  13.38%  19.53%  27.51%
Ellipsis
Validation time: 6390s
Epoch 0: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [2:22:10<00:00,  1.16it/s, loss=0.327]
Total time: 8530s, loss: 0.6810
--------------------------------------------------
Epoch 0: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [2:22:10<00:00,  1.16it/s, loss=0.327]Epoch:    1,
Epoch 1:  93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 9138/9866 [35:35<02:50,  4.28it/s, loss=0.197]Training time: 2135s
Epoch 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [2:22:46<00:00,  1.15it/s, loss=0.197]
                   mrr           mr  hit@1   hit@3  hit@10██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 364/364 [54:06<00:00,  8.92s/it]
tail ranking  0.106378  4059.516945  7.12%  10.13%  18.32%
head ranking  0.021635  5801.423361  1.65%   2.15%   3.17%
mean ranking  0.064006  4930.470153  4.39%   6.14%  10.74%
Ellipsis
Validation time: 6430s
Epoch 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [2:22:46<00:00,  1.15it/s, loss=0.197]
Total time: 8566s, loss: 0.2675
--------------------------------------------------
Epoch 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [2:22:46<00:00,  1.15it/s, loss=0.197]Epoch:    2,
Epoch 2:  93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌            | 9138/9866 [35:40<02:50,  4.27it/s, loss=0.158]Training time: 2140s
Epoch 2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [2:22:37<00:00,  1.15it/s, loss=0.158]
                   mrr           mr  hit@1  hit@3  hit@10███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 364/364 [54:01<00:00,  8.91s/it]
tail ranking  0.086679  4202.042663  5.68%  7.31%  17.77%
head ranking  0.019368  5751.779804  1.38%  2.01%   2.98%
mean ranking  0.053023  4976.911233  3.53%  4.66%  10.37%
Ellipsis
Validation time: 6417s
Epoch 2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [2:22:37<00:00,  1.15it/s, loss=0.158]
Total time: 8557s, loss: 0.1711
--------------------------------------------------
Epoch 2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [2:22:37<00:00,  1.15it/s, loss=0.158]`Trainer.fit` stopped: `max_epochs=3` reached.
Epoch 2: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 9866/9866 [2:22:37<00:00,  1.15it/s, loss=0.158]
model_path: [./checkpoint/FB15k-237N-ko-2023-12-12 01:23:46.407204/FB15k-237N-ko-epoch=000-val_mrr=0.1783.ckpt]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Testing DataLoader 1: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 423/423 [57:29<00:00,  8.15s/it]
                   mrr           mr   hit@1   hit@3  hit@10
tail ranking  0.295813  2947.931825  22.77%  32.48%  44.19%
head ranking  0.059364  5207.459184   4.04%   6.14%  10.46%
mean ranking  0.177589  4077.695504  13.41%  19.31%  27.32%

==================================================
Epoch: test
Ellipsis
==================================================
Testing DataLoader 1: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 423/423 [57:29<00:00,  8.15s/it]
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Runningstage.testing metric      DataLoader 0             DataLoader 1
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
         val_mrr            0.17758888006210327      0.17758888006210327
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
(KG-S2S) chrisjihee@ptlm3:~/proj/KG-S2S$

