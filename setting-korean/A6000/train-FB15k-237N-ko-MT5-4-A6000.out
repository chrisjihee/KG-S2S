(KG-S2S) chrisjihee@ptlm3:~/proj/KG-S2S$ export CUDA_VISIBLE_DEVICES=1
(KG-S2S) chrisjihee@ptlm3:~/proj/KG-S2S$ setting-korean/train-FB15k-237N-ko-MT5-2.sh
Namespace(dataset_path='./data/processed', dataset='FB15k-237N-ko', model='T5Finetuner', precision='32', accelerator='gpu', seed=6382, num_workers=4, save_dir='./checkpoint/FB15k-237N-ko-2023-12-14 01:21:12.414738', pretrained_model='google/mt5-base', batch_size=8, val_batch_size=8, num_beams=40, num_beam_groups=1, src_max_length=512, train_tgt_max_length=512, eval_tgt_max_length=90, epochs=5, lr=0.0005, diversity_penalty=0.0, model_path='', optim='Adam', decoder='beam_search', log_text=False, use_prefix_search=False, src_descrip_max_length=240, tgt_descrip_max_length=240, use_soft_prompt=True, use_rel_prompt_emb=True, skip_n_val_epoch=0, seq_dropout=0.2, temporal=False, n_ent=12068, n_rel=90, vocab_size=250112, model_dim=768)
Global seed set to 6382
/home/chrisjihee/proj/KG-S2S/transformers-4.24.0/src/transformers/convert_slow_tokenizer.py:446: UserWarning: The sentencepiece tokenizer that you are converting to a fast tokenizer uses the byte fallback option which is not implemented in the fast tokenizers. In practice this means that the fast version of the tokenizer can produce unknown tokens whereas the sentencepiece version would have converted these unknown tokens into a sequence of byte tokens matching the original piece of text.
  warnings.warn(

----------------------------------------------------------------------------------
 - pretrained_model.model_type: mt5
 - tokenizer.additional_special_tokens: []
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
 - extra_id_0_tok_id: 250100
----------------------------------------------------------------------------------

tokenizing entities...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 12068/12068 [00:26<00:00, 460.84it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
datamodule construction done.

----------------------------------------------------------------------------------
 * pl.Trainer(accelerator=gpu, precision=32)
----------------------------------------------------------------------------------

GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
model construction done.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [1]

  | Name          | Type                                | Params
----------------------------------------------------------------------
0 | core_t5_model | ModifiedMT5ForConditionalGeneration | 582 M
1 | rel_embed1    | Embedding                           | 69.1 K
2 | rel_embed2    | Embedding                           | 69.1 K
3 | rel_embed3    | Embedding                           | 69.1 K
4 | rel_embed4    | Embedding                           | 69.1 K
----------------------------------------------------------------------
582 M     Trainable params
0         Non-trainable params
582 M     Total params
2,330.711 Total estimated model params size (MB)
Training: 0it [00:00, ?it/s]Epoch:    0,
Epoch 0:  93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                  | 18276/19730 [53:47<04:16,  5.66it/s, loss=0.448]Training time: 3227s
Epoch 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:56:00<00:00,  1.87it/s, loss=0.448]
                   mrr           mr  hit@1  hit@3  hit@10█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:01:41<00:00,  5.09s/it]
tail ranking  0.074186  4100.488904  4.73%  6.38%  13.26%
head ranking  0.023656  5675.091175  1.75%  2.36%   3.35%
mean ranking  0.048921  4887.790040  3.24%  4.37%   8.31%
Ellipsis
Validation time: 7333s
Epoch 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:56:00<00:00,  1.87it/s, loss=0.448]
Total time: 10560s, loss: 0.7950
--------------------------------------------------
Epoch 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:56:00<00:00,  1.87it/s, loss=0.448]Epoch:    1,
Epoch 1:  93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                  | 18276/19730 [54:00<04:17,  5.64it/s, loss=0.364]Training time: 3240s
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:55:37<00:00,  1.87it/s, loss=0.364]
                   mrr           mr  hit@1  hit@3 hit@10██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:01:26<00:00,  5.07s/it]
tail ranking  0.066628  4522.107518  4.68%  5.61%  8.41%
head ranking  0.017421  5841.137967  1.29%  1.63%  2.74%
mean ranking  0.042025  5181.622742  2.98%  3.62%  5.57%
Ellipsis
Validation time: 7297s
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:55:37<00:00,  1.87it/s, loss=0.364]
Total time: 10537s, loss: 0.8831
--------------------------------------------------
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:55:37<00:00,  1.87it/s, loss=0.364]Epoch:    2,
Epoch 2:  93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                  | 18276/19730 [54:01<04:17,  5.64it/s, loss=0.226]Training time: 3241s
Epoch 2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:55:30<00:00,  1.87it/s, loss=0.226]
                   mrr           mr   hit@1   hit@3  hit@10███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:01:16<00:00,  5.06s/it]
tail ranking  0.226790  3238.839154  17.60%  23.93%  32.27%
head ranking  0.034254  5210.754172   1.93%   3.23%   6.55%
mean ranking  0.130522  4224.796663   9.76%  13.58%  19.41%
Ellipsis
Validation time: 7289s
Epoch 2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:55:30<00:00,  1.87it/s, loss=0.226]
Total time: 10530s, loss: 0.2673
--------------------------------------------------
Epoch 2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:55:30<00:00,  1.87it/s, loss=0.226]Epoch:    3,
Epoch 3:  93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                  | 18276/19730 [53:53<04:17,  5.65it/s, loss=0.182]Training time: 3233s
Epoch 3: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:55:14<00:00,  1.88it/s, loss=0.182]
                   mrr           mr   hit@1   hit@3  hit@10███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:01:26<00:00,  5.07s/it]
tail ranking  0.226267  2934.764149  15.81%  25.98%  35.32%
head ranking  0.052036  5119.860141   3.25%   5.20%   9.43%
mean ranking  0.139151  4027.312145   9.53%  15.59%  22.37%
Ellipsis
Validation time: 7280s
Epoch 3: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:55:14<00:00,  1.88it/s, loss=0.182]
Total time: 10514s, loss: 0.1725
--------------------------------------------------
Epoch 3: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:55:14<00:00,  1.88it/s, loss=0.182]Epoch:    4,
Epoch 4:  93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                  | 18276/19730 [53:57<04:17,  5.65it/s, loss=0.133]Training time: 3237s
Epoch 4: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:55:46<00:00,  1.87it/s, loss=0.133]
                   mrr           mr   hit@1   hit@3  hit@10███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:01:29<00:00,  5.08s/it]
tail ranking  0.253401  2757.585584  19.47%  26.91%  36.50%
head ranking  0.057128  5003.461208   3.46%   5.88%  10.10%
mean ranking  0.155264  3880.523396  11.47%  16.39%  23.30%
Ellipsis
Validation time: 7309s
Epoch 4: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:55:46<00:00,  1.87it/s, loss=0.133]
Total time: 10546s, loss: 0.1356
--------------------------------------------------
Epoch 4: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:55:46<00:00,  1.87it/s, loss=0.133]`Trainer.fit` stopped: `max_epochs=5` reached.
Epoch 4: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:56:07<00:00,  1.87it/s, loss=0.133]
model_path: [./checkpoint/FB15k-237N-ko-2023-12-14 01:21:12.414738/FB15k-237N-ko-epoch=004-val_mrr=0.1553.ckpt]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [1]
Testing DataLoader 1: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 846/846 [1:07:31<00:00,  4.79s/it]
                   mrr           mr   hit@1   hit@3  hit@10
tail ranking  0.252602  2870.098492  19.57%  26.74%  36.44%
head ranking  0.058923  5024.997190   3.73%   6.11%  10.31%
mean ranking  0.155763  3947.547841  11.65%  16.42%  23.37%

==================================================
Epoch: test
Ellipsis
==================================================
Testing DataLoader 1: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 846/846 [1:07:31<00:00,  4.79s/it]
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Runningstage.testing metric      DataLoader 0             DataLoader 1
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
         val_mrr            0.1557626724243164       0.1557626724243164
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
(KG-S2S) chrisjihee@ptlm3:~/proj/KG-S2S$

