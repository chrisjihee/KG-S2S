(KG-S2S) chrisjihee@ptlm3:~/proj/KG-S2S$ export CUDA_VISIBLE_DEVICES=0
(KG-S2S) chrisjihee@ptlm3:~/proj/KG-S2S$ setting-korean/train-FB15k-237N-ko-MT5-1.sh
Namespace(dataset_path='./data/processed', dataset='FB15k-237N-ko', model='T5Finetuner', precision='32', accelerator='gpu', seed=6382, num_workers=4, save_dir='./checkpoint/FB15k-237N-ko-2023-12-14 01:21:05.562685', pretrained_model='google/mt5-base', batch_size=8, val_batch_size=8, num_beams=40, num_beam_groups=1, src_max_length=512, train_tgt_max_length=512, eval_tgt_max_length=90, epochs=5, lr=0.001, diversity_penalty=0.0, model_path='', optim='Adam', decoder='beam_search', log_text=False, use_prefix_search=False, src_descrip_max_length=240, tgt_descrip_max_length=240, use_soft_prompt=True, use_rel_prompt_emb=True, skip_n_val_epoch=0, seq_dropout=0.2, temporal=False, n_ent=12068, n_rel=90, vocab_size=250112, model_dim=768)
Global seed set to 6382
/home/chrisjihee/proj/KG-S2S/transformers-4.24.0/src/transformers/convert_slow_tokenizer.py:446: UserWarning: The sentencepiece tokenizer that you are converting to a fast tokenizer uses the byte fallback option which is not implemented in the fast tokenizers. In practice this means that the fast version of the tokenizer can produce unknown tokens whereas the sentencepiece version would have converted these unknown tokens into a sequence of byte tokens matching the original piece of text.
  warnings.warn(

----------------------------------------------------------------------------------
 - pretrained_model.model_type: mt5
 - tokenizer.additional_special_tokens: []
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
 - extra_id_0_tok_id: 250100
----------------------------------------------------------------------------------

tokenizing entities...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 12068/12068 [00:26<00:00, 459.51it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
datamodule construction done.

----------------------------------------------------------------------------------
 * pl.Trainer(accelerator=gpu, precision=32)
----------------------------------------------------------------------------------

GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
model construction done.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]

  | Name          | Type                                | Params
----------------------------------------------------------------------
0 | core_t5_model | ModifiedMT5ForConditionalGeneration | 582 M
1 | rel_embed1    | Embedding                           | 69.1 K
2 | rel_embed2    | Embedding                           | 69.1 K
3 | rel_embed3    | Embedding                           | 69.1 K
4 | rel_embed4    | Embedding                           | 69.1 K
----------------------------------------------------------------------
582 M     Trainable params
0         Non-trainable params
582 M     Total params
2,330.711 Total estimated model params size (MB)
Training: 0it [00:00, ?it/s]Epoch:    0,
Epoch 0:  93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                  | 18276/19730 [53:25<04:15,  5.70it/s, loss=0.429]Training time: 3205s
Epoch 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:57:33<00:00,  1.85it/s, loss=0.429]
                   mrr           mr  hit@1  hit@3 hit@10██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:02:37<00:00,  5.17s/it]
tail ranking  0.063906  4608.995871  4.59%  5.26%  9.69%
head ranking  0.016646  5847.523826  1.29%  1.58%  2.32%
mean ranking  0.040276  5228.259849  2.94%  3.42%  6.00%
Ellipsis
Validation time: 7447s
Epoch 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:57:33<00:00,  1.85it/s, loss=0.429]
Total time: 10653s, loss: 0.9178
--------------------------------------------------
Epoch 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:57:33<00:00,  1.85it/s, loss=0.429]Epoch:    1,
Epoch 1:  93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                  | 18276/19730 [53:32<04:15,  5.69it/s, loss=0.245]Training time: 3212s
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:57:56<00:00,  1.85it/s, loss=0.245]
                   mrr           mr  hit@1  hit@3 hit@10██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:02:44<00:00,  5.18s/it]
tail ranking  0.066155  4513.549458  4.68%  5.59%  9.17%
head ranking  0.015684  5908.810081  1.29%  1.63%  1.84%
mean ranking  0.040920  5211.179769  2.98%  3.61%  5.50%
Ellipsis
Validation time: 7463s
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:57:56<00:00,  1.85it/s, loss=0.245]
Total time: 10676s, loss: 0.3064
--------------------------------------------------
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:57:56<00:00,  1.85it/s, loss=0.245]Epoch:    2,
Epoch 2:  93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                  | 18276/19730 [53:44<04:16,  5.67it/s, loss=0.188]Training time: 3224s
Epoch 2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:58:32<00:00,  1.84it/s, loss=0.188]
                   mrr           mr  hit@1  hit@3  hit@10█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:03:00<00:00,  5.20s/it]
tail ranking  0.067917  4374.608120  4.59%  5.56%  11.11%
head ranking  0.017073  5844.854292  1.29%  1.96%   2.27%
mean ranking  0.042495  5109.731206  2.94%  3.76%   6.69%
Ellipsis
Validation time: 7488s
Epoch 2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:58:32<00:00,  1.84it/s, loss=0.188]
Total time: 10712s, loss: 0.1919
--------------------------------------------------
Epoch 2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:58:32<00:00,  1.84it/s, loss=0.188]Epoch:    3,
Epoch 3:  93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                  | 18276/19730 [53:40<04:16,  5.67it/s, loss=0.167]Training time: 3221s
Epoch 3: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:58:19<00:00,  1.84it/s, loss=0.167]
                   mrr           mr  hit@1  hit@3 hit@10██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:02:55<00:00,  5.19s/it]
tail ranking  0.066885  4359.964218  4.59%  5.42%  9.81%
head ranking  0.016926  5788.491829  1.29%  1.63%  2.46%
mean ranking  0.041906  5074.228023  2.94%  3.53%  6.13%
Ellipsis
Validation time: 7478s
Epoch 3: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:58:19<00:00,  1.84it/s, loss=0.167]
Total time: 10699s, loss: 0.1569
--------------------------------------------------
Epoch 3: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:58:19<00:00,  1.84it/s, loss=0.167]Epoch:    4,
Epoch 4:  93%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                  | 18276/19730 [53:42<04:16,  5.67it/s, loss=0.146]Training time: 3222s
Epoch 4: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:58:04<00:00,  1.85it/s, loss=0.146]
                   mrr           mr  hit@1  hit@3 hit@10██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 727/727 [1:02:42<00:00,  5.18s/it]
tail ranking  0.066647  4714.219336  4.59%  5.38%  9.39%
head ranking  0.015861  5857.350077  1.29%  1.60%  1.79%
mean ranking  0.041254  5285.784707  2.94%  3.49%  5.59%
Ellipsis
Validation time: 7461s
Epoch 4: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:58:04<00:00,  1.85it/s, loss=0.146]
Total time: 10684s, loss: 0.1418
--------------------------------------------------
Epoch 4: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:58:04<00:00,  1.85it/s, loss=0.146]`Trainer.fit` stopped: `max_epochs=5` reached.
Epoch 4: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 19730/19730 [2:58:04<00:00,  1.85it/s, loss=0.146]
model_path: [./checkpoint/FB15k-237N-ko-2023-12-14 01:21:05.562685/FB15k-237N-ko-epoch=002-val_mrr=0.0425.ckpt]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Testing DataLoader 1: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 846/846 [1:08:11<00:00,  4.84s/it]
                   mrr           mr  hit@1  hit@3  hit@10
tail ranking  0.071724  4418.269447  5.09%  5.87%  11.58%
head ranking  0.019719  5690.683082  1.48%  2.37%   2.66%
mean ranking  0.045722  5054.476264  3.28%  4.12%   7.12%

==================================================
Epoch: test
Ellipsis
==================================================
Testing DataLoader 1: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 846/846 [1:08:11<00:00,  4.84s/it]
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Runningstage.testing metric      DataLoader 0             DataLoader 1
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
         val_mrr            0.04572165757417679      0.04572165757417679
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
(KG-S2S) chrisjihee@ptlm3:~/proj/KG-S2S$

