#export CUDA_VISIBLE_DEVICES=1
#export CUDA_VISIBLE_DEVICES=5
#python3 main.py -dataset FB15k-237N-ko -lr 0.0005 -num_beams 40 -seq_dropout 0.2 -use_soft_prompt -use_rel_prompt_emb -src_descrip_max_length 200 -tgt_descrip_max_length 200 -pretrained_model pretrained-pro/ETRI-KEByT5-Base-230426
python3 main.py -dataset FB15k-237N-ko \
                -lr 0.0005 \
                -precision 32 \
                -epoch 15 \
                -batch_size 4 \
                -val_batch_size 2 \
                -num_beams 40 \
                -seq_dropout 0.2 \
                -use_soft_prompt \
                -use_rel_prompt_emb \
                -src_descrip_max_length 200 \
                -tgt_descrip_max_length 200 \
                -eval_tgt_max_length 75 \
                -pretrained_model pretrained-pro/ETRI-KEByT5-Base-230426



(KG-S2S) chrisjihee@ptlm3:~/proj/KG-S2S$ export CUDA_VISIBLE_DEVICES=1
(KG-S2S) chrisjihee@ptlm3:~/proj/KG-S2S$ setting-korean/train-FB15k-237N-ko-KeByT5-base-4.sh
Namespace(dataset_path='./data/processed', dataset='FB15k-237N-ko', model='T5Finetuner', precision='32', accelerator='gpu', seed=41504, num_workers=12, save_dir='./checkpoint/FB15k-237N-ko=ETRI-KEByT5-Base-230426=1214.222458', pretrained_model='pretrained-pro/ETRI-KEByT5-Base-230426', batch_size=4, val_batch_size=2, num_beams=40, num_beam_groups=1, src_max_length=512, train_tgt_max_length=512, eval_tgt_max_length=75, epochs=15, lr=0.0005, diversity_penalty=0.0, model_path='', optim='Adam', decoder='beam_search', log_text=False, use_prefix_search=False, src_descrip_max_length=200, tgt_descrip_max_length=200, use_soft_prompt=True, use_rel_prompt_emb=True, check_every_n_epochs=3, seq_dropout=0.2, temporal=False, n_ent=12068, n_rel=90, vocab_size=384, model_dim=1536)
Global seed set to 41504

----------------------------------------------------------------------------------
 - pretrained_model.model_type: t5
 - tokenizer.additional_special_tokens: ['<extra_id_0>', '<extra_id_1>', '<extra_id_2>', '<extra_id_3>', '<extra_id_4>', '<extra_id_5>', '<extra_id_6>', '<extra_id_7>', '<extra_id_8>', '<extra_id_9>', '<extra_id_10>', '<extra_id_11>', '<extra_id_12>', '<extra_id_13>', '<extra_id_14>', '<extra_id_15>', '<extra_id_16>', '<extra_id_17>', '<extra_id_18>', '<extra_id_19>', '<extra_id_20>', '<extra_id_21>', '<extra_id_22>', '<extra_id_23>', '<extra_id_24>', '<extra_id_25>', '<extra_id_26>', '<extra_id_27>', '<extra_id_28>', '<extra_id_29>', '<extra_id_30>', '<extra_id_31>', '<extra_id_32>', '<extra_id_33>', '<extra_id_34>', '<extra_id_35>', '<extra_id_36>', '<extra_id_37>', '<extra_id_38>', '<extra_id_39>', '<extra_id_40>', '<extra_id_41>', '<extra_id_42>', '<extra_id_43>', '<extra_id_44>', '<extra_id_45>', '<extra_id_46>', '<extra_id_47>', '<extra_id_48>', '<extra_id_49>', '<extra_id_50>', '<extra_id_51>', '<extra_id_52>', '<extra_id_53>', '<extra_id_54>', '<extra_id_55>', '<extra_id_56>', '<extra_id_57>', '<extra_id_58>', '<extra_id_59>', '<extra_id_60>', '<extra_id_61>', '<extra_id_62>', '<extra_id_63>', '<extra_id_64>', '<extra_id_65>', '<extra_id_66>', '<extra_id_67>', '<extra_id_68>', '<extra_id_69>', '<extra_id_70>', '<extra_id_71>', '<extra_id_72>', '<extra_id_73>', '<extra_id_74>', '<extra_id_75>', '<extra_id_76>', '<extra_id_77>', '<extra_id_78>', '<extra_id_79>', '<extra_id_80>', '<extra_id_81>', '<extra_id_82>', '<extra_id_83>', '<extra_id_84>', '<extra_id_85>', '<extra_id_86>', '<extra_id_87>', '<extra_id_88>', '<extra_id_89>', '<extra_id_90>', '<extra_id_91>', '<extra_id_92>', '<extra_id_93>', '<extra_id_94>', '<extra_id_95>', '<extra_id_96>', '<extra_id_97>', '<extra_id_98>', '<extra_id_99>', '<extra_id_100>', '<extra_id_101>', '<extra_id_102>', '<extra_id_103>', '<extra_id_104>', '<extra_id_105>', '<extra_id_106>', '<extra_id_107>', '<extra_id_108>', '<extra_id_109>', '<extra_id_110>', '<extra_id_111>', '<extra_id_112>', '<extra_id_113>', '<extra_id_114>', '<extra_id_115>', '<extra_id_116>', '<extra_id_117>', '<extra_id_118>', '<extra_id_119>', '<extra_id_120>', '<extra_id_121>', '<extra_id_122>', '<extra_id_123>', '<extra_id_124>']
 - extra_id_0_tok_id: 259
----------------------------------------------------------------------------------

tokenizing entities...
100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 12068/12068 [02:32<00:00, 79.05it/s]
datamodule construction done.

----------------------------------------------------------------------------------
 * pl.Trainer(accelerator=gpu, precision=32, max_epochs=15, every_n_epoch=3)
----------------------------------------------------------------------------------

GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
model construction done.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [1]

  | Name          | Type                               | Params
---------------------------------------------------------------------
0 | core_t5_model | ModifiedT5ForConditionalGeneration | 581 M
1 | rel_embed1    | Embedding                          | 138 K
2 | rel_embed2    | Embedding                          | 138 K
3 | rel_embed3    | Embedding                          | 138 K
4 | rel_embed4    | Embedding                          | 138 K
---------------------------------------------------------------------
582 M     Trainable params
0         Non-trainable params
582 M     Total params
2,328.825 Total estimated model params size (MB)
Training: 0it [00:00, ?it/s]

======================================================================
Epoch:    0,
Epoch 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:21:51<00:00,  4.29it/s, loss=0.191]
Total time: 8511s, loss: 0.2567
Epoch 0: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:21:51<00:00,  4.29it/s, loss=0.191]

======================================================================
Epoch:    1,
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:22:05<00:00,  4.29it/s, loss=0.105]
Total time: 8525s, loss: 0.1265
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:22:05<00:00,  4.29it/s, loss=0.105]

======================================================================
Epoch:    2,
Epoch 2: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:21:53<00:00,  4.29it/s, loss=0.0635]
Training time: 8513s
Epoch 2: : 42365it [4:23:53,  2.68it/s, loss=0.0635]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [1:01:08<00:00,  1.26s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.298534  23.14%  31.91%  44.37%
head  0.058736   3.47%   6.30%  10.94%
mean  0.178635  13.31%  19.10%  27.65%

Ellipsis
Validation time: 7319s
Epoch 2: : 42365it [4:23:53,  2.68it/s, loss=0.0635]
Total time: 15890s, loss: 0.0861
Epoch 2: : 42365it [4:24:50,  2.67it/s, loss=0.0635]

======================================================================
Epoch:    3,
Epoch 3: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:21:48<00:00,  4.30it/s, loss=0.0543]
Total time: 8508s, loss: 0.0685
Epoch 3: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:21:48<00:00,  4.30it/s, loss=0.0543]

======================================================================
Epoch:    4,
Epoch 4: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:22:04<00:00,  4.29it/s, loss=0.0514]
Total time: 8524s, loss: 0.0601
Epoch 4: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:22:04<00:00,  4.29it/s, loss=0.0514]

======================================================================
Epoch:    5,
Epoch 5:  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                 | 36551/42365 [2:21:59<22:35,  4.29it/s, loss=0.048]
Training time: 8519s
Epoch 5: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [4:24:06<00:00,  2.67it/s, loss=0.048]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [1:01:16<00:00,  1.26s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.303821  22.54%  33.94%  47.24%
head  0.061852   3.72%   6.73%  11.54%
mean  0.182836  13.13%  20.33%  29.39%

Ellipsis
Validation time: 7327s
Epoch 5: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [4:24:06<00:00,  2.67it/s, loss=0.048]
Total time: 15903s, loss: 0.0540
Epoch 5: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [4:25:03<00:00,  2.66it/s, loss=0.048]

======================================================================
Epoch:    6,
Epoch 6: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:21:34<00:00,  4.30it/s, loss=0.0447]
Total time: 8494s, loss: 0.0504
Epoch 6: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:21:34<00:00,  4.30it/s, loss=0.0447]

======================================================================
Epoch:    7,
Epoch 7: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:21:39<00:00,  4.30it/s, loss=0.0411]
Total time: 8499s, loss: 0.0476
Epoch 7: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:21:39<00:00,  4.30it/s, loss=0.0411]

======================================================================
Epoch:    8,
Epoch 8:  86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                 | 36551/42365 [2:21:16<22:28,  4.31it/s, loss=0.0421]
Training time: 8476s
Epoch 8: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [4:23:31<00:00,  2.68it/s, loss=0.0421]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [1:01:20<00:00,  1.27s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.326699  24.84%  36.64%  48.48%
head  0.065653   3.87%   6.93%  12.35%
mean  0.196176  14.36%  21.79%  30.41%

Ellipsis
Validation time: 7334s
Epoch 8: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [4:23:31<00:00,  2.68it/s, loss=0.0421]
Total time: 15871s, loss: 0.0454
Epoch 8: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [4:24:31<00:00,  2.67it/s, loss=0.0421]

======================================================================
Epoch:    9,
Epoch 9: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:21:03<00:00,  4.32it/s, loss=0.0427]
Total time: 8463s, loss: 0.0438
Epoch 9: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:21:03<00:00,  4.32it/s, loss=0.0427]

======================================================================
Epoch:   10,
Epoch 10: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:20:56<00:00,  4.32it/s, loss=0.0459]
Total time: 8456s, loss: 0.0423
Epoch 10: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:20:56<00:00,  4.32it/s, loss=0.0459]

======================================================================
Epoch:   11,
Epoch 11:  86%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                 | 36551/42365 [2:20:25<22:20,  4.34it/s, loss=0.0319]
Training time: 8425s
Epoch 11: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [4:22:42<00:00,  2.69it/s, loss=0.0319]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [1:01:20<00:00,  1.27s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.324941  24.79%  35.54%  48.58%
head  0.070716   4.32%   7.55%  13.09%
mean  0.197828  14.55%  21.55%  30.84%

Ellipsis
Validation time: 7336s
Epoch 11: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [4:22:42<00:00,  2.69it/s, loss=0.0319]
Total time: 15820s, loss: 0.0412
Epoch 11: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [4:23:40<00:00,  2.68it/s, loss=0.0319]

======================================================================
Epoch:   12,
Epoch 12: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:20:36<00:00,  4.33it/s, loss=0.0402]
Total time: 8436s, loss: 0.0404
Epoch 12: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:20:36<00:00,  4.33it/s, loss=0.0402]

======================================================================
Epoch:   13,
Epoch 13: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:21:03<00:00,  4.32it/s, loss=0.0383]
Total time: 8463s, loss: 0.0398
Epoch 13: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:21:03<00:00,  4.32it/s, loss=0.0383]

======================================================================
Epoch:   14,
Epoch 14:  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                 | 36551/42365 [2:19:49<22:14,  4.36it/s, loss=0.04]
Training time: 8389s
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████ | 42207/42365 [4:18:08<00:57,  2.73it/s, loss=0.04]
Epoch 14: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [4:21:26<00:00,  2.70it/s, loss=0.04]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [1:00:54<00:00,  1.26s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.316202  22.98%  35.94%  48.99%
head  0.070394   4.28%   7.47%  12.52%
mean  0.193298  13.63%  21.70%  30.76%

Ellipsis
Validation time: 7296s
Epoch 14: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [4:21:26<00:00,  2.70it/s, loss=0.04]
Total time: 15747s, loss: 0.0391
Epoch 14: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [4:22:27<00:00,  2.69it/s, loss=0.04]`Trainer.fit` stopped: `max_epochs=15` reached.
Epoch 14: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [4:22:27<00:00,  2.69it/s, loss=0.04]
model_path: [./checkpoint/FB15k-237N-ko=ETRI-KEByT5-Base-230426=1214.222458/FB15k-237N-ko-epoch=011-val_mrr=0.1978.ckpt]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [1]
Testing DataLoader 1: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3381/3381 [1:02:43<00:00,  1.11s/it]


           mrr   hit@1   hit@3  hit@10
tail  0.317437  24.00%  35.12%  47.53%
head  0.072318   4.45%   8.00%  13.01%
mean  0.194878  14.23%  21.56%  30.27%

======================================================================
Epoch: test
Ellipsis
======================================================================
Testing DataLoader 1: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3381/3381 [1:02:43<00:00,  1.11s/it]
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Runningstage.testing metric      DataLoader 0             DataLoader 1
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
         val_mrr            0.1948775351047516       0.1948775351047516
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
(KG-S2S) chrisjihee@ptlm3:~/proj/KG-S2S$

