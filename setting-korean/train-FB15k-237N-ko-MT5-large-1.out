#export CUDA_VISIBLE_DEVICES=0
#export CUDA_VISIBLE_DEVICES=4
#python3 main.py -dataset FB15k-237N-ko -lr 0.001 -num_beams 40 -seq_dropout 0.2 -use_soft_prompt -use_rel_prompt_emb -src_descrip_max_length 200 -tgt_descrip_max_length 200 -pretrained_model google/mt5-base
python3 main.py -dataset FB15k-237N-ko \
                -lr 0.001 \
                -precision bf16 \
                -epoch 15 \
                -batch_size 4 \
                -val_batch_size 2 \
                -num_beams 40 \
                -seq_dropout 0.2 \
                -use_soft_prompt \
                -use_rel_prompt_emb \
                -src_descrip_max_length 200 \
                -tgt_descrip_max_length 200 \
                -eval_tgt_max_length 75 \
                -pretrained_model google/mt5-large



(KG-S2S) dlt@dl012:~/proj/KG-S2S$ export CUDA_VISIBLE_DEVICES=4
(KG-S2S) dlt@dl012:~/proj/KG-S2S$ setting-korean/train-FB15k-237N-ko-MT5-large-1.sh
Namespace(dataset_path='./data/processed', dataset='FB15k-237N-ko', model='T5Finetuner', precision='bf16', accelerator='gpu', seed=41504, num_workers=12, save_dir='./checkpoint/FB15k-237N-ko=mt5-large=1214.224259', pretrained_model='google/mt5-large', batch_size=4, val_batch_size=2, num_beams=40, num_beam_groups=1, src_max_length=512, train_tgt_max_length=512, eval_tgt_max_length=75, epochs=15, lr=0.001, diversity_penalty=0.0, model_path='', optim='Adam', decoder='beam_search', log_text=False, use_prefix_search=False, src_descrip_max_length=200, tgt_descrip_max_length=200, use_soft_prompt=True, use_rel_prompt_emb=True, check_every_n_epochs=3, seq_dropout=0.2, temporal=False, n_ent=12068, n_rel=90, vocab_size=250112, model_dim=1024)
Global seed set to 41504
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.

----------------------------------------------------------------------------------
 - pretrained_model.model_type: mt5
 - tokenizer.additional_special_tokens: ['<extra_id_0>', '<extra_id_1>']
 - extra_id_0_tok_id: 250100
----------------------------------------------------------------------------------

tokenizing entities...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 12068/12068 [00:19<00:00, 608.74it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
datamodule construction done.

----------------------------------------------------------------------------------
 * pl.Trainer(accelerator=gpu, precision=bf16, max_epochs=15, every_n_epoch=3)
----------------------------------------------------------------------------------

Using bfloat16 Automatic Mixed Precision (AMP)
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
model construction done.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [4]

  | Name          | Type                                | Params
----------------------------------------------------------------------
0 | core_t5_model | ModifiedMT5ForConditionalGeneration | 1.2 B
1 | rel_embed1    | Embedding                           | 92.2 K
2 | rel_embed2    | Embedding                           | 92.2 K
3 | rel_embed3    | Embedding                           | 92.2 K
4 | rel_embed4    | Embedding                           | 92.2 K
----------------------------------------------------------------------
1.2 B     Trainable params
0         Non-trainable params
1.2 B     Total params
4,919.800 Total estimated model params size (MB)
Training: 0it [00:00, ?it/s]

======================================================================
Epoch:    0,
Epoch 0: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:21:57<00:00,  4.29it/s, loss=0.28]
Total time: 8517s, loss: 0.6417
Epoch 0: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:21:57<00:00,  4.29it/s, loss=0.28]

======================================================================
Epoch:    1,
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:20:15<00:00,  4.34it/s, loss=0.161]
Total time: 8415s, loss: 0.2224
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:20:15<00:00,  4.34it/s, loss=0.161]

======================================================================
Epoch:    2,
Epoch 2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:21:48<00:00,  4.30it/s, loss=0.148]
Training time: 8508s
Epoch 2: : 42365it [6:46:53,  1.74it/s, loss=0.148]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [2:12:42<00:00,  2.74s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.265698  19.34%  29.16%  41.39%
head  0.049377   2.91%   5.28%   8.83%
mean  0.157538  11.12%  17.22%  25.11%

Ellipsis
Validation time: 15904s
Epoch 2: : 42365it [6:46:53,  1.74it/s, loss=0.148]
Total time: 24441s, loss: 0.1668
Epoch 2: : 42365it [6:47:21,  1.73it/s, loss=0.148]

======================================================================
Epoch:    3,
Epoch 3: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:19:36<00:00,  4.36it/s, loss=0.198]
Total time: 8376s, loss: 0.1818
Epoch 3: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:19:36<00:00,  4.36it/s, loss=0.198]

======================================================================
Epoch:    4,
Epoch 4: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:19:46<00:00,  4.36it/s, loss=0.175]
Total time: 8386s, loss: 0.1556
Epoch 4: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:19:46<00:00,  4.36it/s, loss=0.175]

======================================================================
Epoch:    5,
Epoch 5:  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                 | 36551/42365 [2:18:49<22:04,  4.39it/s, loss=0.199]
Training time: 8329s
Epoch 5: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:44:33<00:00,  1.75it/s, loss=0.199]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [2:13:21<00:00,  2.75s/it]

           mrr  hit@1  hit@3  hit@10
tail  0.071195  4.39%  6.35%  12.06%
head  0.017217  1.29%  1.75%   2.56%
mean  0.044206  2.84%  4.05%   7.31%

Ellipsis
Validation time: 15944s
Epoch 5: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:44:33<00:00,  1.75it/s, loss=0.199]
Total time: 24302s, loss: 0.1526
Epoch 5: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:45:02<00:00,  1.74it/s, loss=0.199]

======================================================================
Epoch:    6,
Epoch 6: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:19:52<00:00,  4.36it/s, loss=0.149]
Total time: 8392s, loss: 0.1468
Epoch 6: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:19:52<00:00,  4.36it/s, loss=0.149]

======================================================================
Epoch:    7,
Epoch 7: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:19:02<00:00,  4.38it/s, loss=0.155]
Total time: 8342s, loss: 0.1440
Epoch 7: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:19:02<00:00,  4.38it/s, loss=0.155]

======================================================================
Epoch:    8,
Epoch 8:  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                 | 36551/42365 [2:17:47<21:55,  4.42it/s, loss=0.137]
Training time: 8267s
Epoch 8: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:43:11<00:00,  1.75it/s, loss=0.137]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [2:13:21<00:00,  2.75s/it]

           mrr  hit@1  hit@3  hit@10
tail  0.070048  4.58%  6.74%  10.63%
head  0.016325  1.29%  1.70%   2.13%
mean  0.043187  2.93%  4.22%   6.38%

Ellipsis
Validation time: 15923s
Epoch 8: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:43:11<00:00,  1.75it/s, loss=0.137]
Total time: 24218s, loss: 0.1429
Epoch 8: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:43:38<00:00,  1.75it/s, loss=0.137]

======================================================================
Epoch:    9,
Epoch 9: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:17:53<00:00,  4.42it/s, loss=0.133]
Total time: 8273s, loss: 0.1412
Epoch 9: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:17:53<00:00,  4.42it/s, loss=0.133]

======================================================================
Epoch:   10,
Epoch 10: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:17:23<00:00,  4.43it/s, loss=0.141]
Total time: 8243s, loss: 0.1390
Epoch 10: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:17:23<00:00,  4.43it/s, loss=0.141]

======================================================================
Epoch:   11,
Epoch 11:  86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                 | 36551/42365 [2:17:05<21:48,  4.44it/s, loss=0.138]
Training time: 8226s
Epoch 11: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:41:21<00:00,  1.76it/s, loss=0.138]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [2:12:12<00:00,  2.73s/it]

           mrr  hit@1  hit@3  hit@10
tail  0.076692  4.56%  8.12%  12.76%
head  0.017268  1.29%  1.62%   2.61%
mean  0.046980  2.92%  4.87%   7.69%

Ellipsis
Validation time: 15855s
Epoch 11: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:41:21<00:00,  1.76it/s, loss=0.138]
Total time: 24109s, loss: 0.1371
Epoch 11: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:41:49<00:00,  1.76it/s, loss=0.138]

======================================================================
Epoch:   12,
Epoch 12: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:17:43<00:00,  4.42it/s, loss=0.137]
Total time: 8263s, loss: 0.1360
Epoch 12: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:17:43<00:00,  4.42it/s, loss=0.137]

======================================================================
Epoch:   13,
Epoch 13: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:17:02<00:00,  4.45it/s, loss=0.141]
Total time: 8222s, loss: 0.1347
Epoch 13: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:17:02<00:00,  4.45it/s, loss=0.141]

======================================================================
Epoch:   14,
Epoch 14:  86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                 | 36551/42365 [2:17:33<21:52,  4.43it/s, loss=0.137]
Training time: 8254s
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:42:11<00:00,  1.76it/s, loss=0.137]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [2:12:19<00:00,  2.73s/it]

           mrr  hit@1  hit@3  hit@10
tail  0.069603  4.40%  6.42%  10.48%
head  0.015285  1.29%  1.51%   1.91%
mean  0.042444  2.85%  3.97%   6.19%

Ellipsis
Validation time: 15877s
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:42:11<00:00,  1.76it/s, loss=0.137]
Total time: 24158s, loss: 0.1341
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:42:38<00:00,  1.75it/s, loss=0.137]`Trainer.fit` stopped: `max_epochs=15` reached.
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:42:38<00:00,  1.75it/s, loss=0.137]
model_path: [./checkpoint/FB15k-237N-ko=mt5-large=1214.224259/FB15k-237N-ko-epoch=002-val_mrr=0.1575.ckpt]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [4]
Testing DataLoader 1: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3381/3381 [2:20:07<00:00,  2.49s/it]


           mrr   hit@1   hit@3  hit@10
tail  0.265236  19.55%  29.46%  40.62%
head  0.051969   3.24%   5.60%   8.96%
mean  0.158602  11.39%  17.53%  24.79%

======================================================================
Epoch: test
Ellipsis
======================================================================
Testing DataLoader 1: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3381/3381 [2:20:07<00:00,  2.49s/it]
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Runningstage.testing metric      DataLoader 0             DataLoader 1
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
         val_mrr            0.15860234200954437      0.15860234200954437
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
(KG-S2S) dlt@dl012:~/proj/KG-S2S$

