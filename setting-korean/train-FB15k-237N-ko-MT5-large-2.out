#export CUDA_VISIBLE_DEVICES=1
#export CUDA_VISIBLE_DEVICES=5
#python3 main.py -dataset FB15k-237N-ko -lr 0.0005 -num_beams 40 -seq_dropout 0.2 -use_soft_prompt -use_rel_prompt_emb -src_descrip_max_length 200 -tgt_descrip_max_length 200 -pretrained_model google/mt5-base
python3 main.py -dataset FB15k-237N-ko \
                -lr 0.0005 \
                -precision bf16 \
                -epoch 15 \
                -batch_size 4 \
                -val_batch_size 2 \
                -num_beams 40 \
                -seq_dropout 0.2 \
                -use_soft_prompt \
                -use_rel_prompt_emb \
                -src_descrip_max_length 200 \
                -tgt_descrip_max_length 200 \
                -eval_tgt_max_length 75 \
                -pretrained_model google/mt5-large



(KG-S2S) dlt@dl012:~/proj/KG-S2S$ export CUDA_VISIBLE_DEVICES=5
(KG-S2S) dlt@dl012:~/proj/KG-S2S$ setting-korean/train-FB15k-237N-ko-MT5-large-2.sh
Namespace(dataset_path='./data/processed', dataset='FB15k-237N-ko', model='T5Finetuner', precision='bf16', accelerator='gpu', seed=41504, num_workers=12, save_dir='./checkpoint/FB15k-237N-ko=mt5-large=1214.224302', pretrained_model='google/mt5-large', batch_size=4, val_batch_size=2, num_beams=40, num_beam_groups=1, src_max_length=512, train_tgt_max_length=512, eval_tgt_max_length=75, epochs=15, lr=0.0005, diversity_penalty=0.0, model_path='', optim='Adam', decoder='beam_search', log_text=False, use_prefix_search=False, src_descrip_max_length=200, tgt_descrip_max_length=200, use_soft_prompt=True, use_rel_prompt_emb=True, check_every_n_epochs=3, seq_dropout=0.2, temporal=False, n_ent=12068, n_rel=90, vocab_size=250112, model_dim=1024)
Global seed set to 41504
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.

----------------------------------------------------------------------------------
 - pretrained_model.model_type: mt5
 - tokenizer.additional_special_tokens: ['<extra_id_0>', '<extra_id_1>']
 - extra_id_0_tok_id: 250100
----------------------------------------------------------------------------------

tokenizing entities...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 12068/12068 [00:19<00:00, 610.48it/s]
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
datamodule construction done.

----------------------------------------------------------------------------------
 * pl.Trainer(accelerator=gpu, precision=bf16, max_epochs=15, every_n_epoch=3)
----------------------------------------------------------------------------------

Using bfloat16 Automatic Mixed Precision (AMP)
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
model construction done.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [5]

  | Name          | Type                                | Params
----------------------------------------------------------------------
0 | core_t5_model | ModifiedMT5ForConditionalGeneration | 1.2 B
1 | rel_embed1    | Embedding                           | 92.2 K
2 | rel_embed2    | Embedding                           | 92.2 K
3 | rel_embed3    | Embedding                           | 92.2 K
4 | rel_embed4    | Embedding                           | 92.2 K
----------------------------------------------------------------------
1.2 B     Trainable params
0         Non-trainable params
1.2 B     Total params
4,919.800 Total estimated model params size (MB)
Training: 0it [00:00, ?it/s]

======================================================================
Epoch:    0,
Epoch 0:  11%|████████████████████████████▎                                                                                                                                                                                           Epoch 0:  11%|████████████████████████████▎                                                                                                                                                                                           Epoch 0:  11%|████████████████████████████▎                                                                                                                                                                                           Epoch 0:  11%|████████████████████████████▎                                                                                                                                                                                           Epoch 0:  11%|████████████████████████████▎                                                                                                                                                                                           Epoch 0:  11%|███████████████████                                                                                                                                                   | 4200/36551 [16:50<2:09:46,  4.15it/s, loss=1.17]Epoch 0:  12%|███████████████████▉                                                                                                                                        Epoch 0: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:23:57<00:00,  4.23it/s, loss=0.29]
Total time: 8637s, loss: 0.7979
Epoch 0: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:23:57<00:00,  4.23it/s, loss=0.29]

======================================================================
Epoch:    1,
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:21:32<00:00,  4.30it/s, loss=0.173]
Total time: 8492s, loss: 0.2297
Epoch 1: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:21:32<00:00,  4.30it/s, loss=0.173]

======================================================================
Epoch:    2,
Epoch 2: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:21:36<00:00,  4.30it/s, loss=0.166]
Training time: 8496s
Epoch 2: : 42365it [6:52:35,  1.71it/s, loss=0.166]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [2:14:26<00:00,  2.77s/it]

           mrr   hit@1   hit@3  hit@10
tail  0.147153  10.10%  14.12%  25.49%
head  0.036706   2.43%   3.73%   6.02%
mean  0.091930   6.26%   8.93%  15.76%

Ellipsis
Validation time: 16258s
Epoch 2: : 42365it [6:52:35,  1.71it/s, loss=0.166]
Total time: 24785s, loss: 0.1646
Epoch 2: : 42365it [6:53:05,  1.71it/s, loss=0.166]

======================================================================
Epoch:    3,
Epoch 3: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:22:11<00:00,  4.28it/s, loss=0.146]
Total time: 8531s, loss: 0.1505
Epoch 3: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:22:11<00:00,  4.28it/s, loss=0.146]

======================================================================
Epoch:    4,
Epoch 4: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:23:34<00:00,  4.24it/s, loss=0.164]
Total time: 8614s, loss: 0.1456
Epoch 4: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:23:34<00:00,  4.24it/s, loss=0.164]

======================================================================
Epoch:    5,
Epoch 5:  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                 | 36551/42365 [2:21:09<22:27,  4.32it/s, loss=0.177]
Training time: 8469s
Epoch 5: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:53:03<00:00,  1.71it/s, loss=0.177]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [2:17:59<00:00,  2.85s/it]

           mrr  hit@1  hit@3  hit@10
tail  0.082595  4.52%  7.72%  14.98%
head  0.020610  1.29%  2.37%   3.25%
mean  0.051603  2.91%  5.05%   9.12%

Ellipsis
Validation time: 16313s
Epoch 5: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:53:03<00:00,  1.71it/s, loss=0.177]
Total time: 24814s, loss: 0.1396
Epoch 5: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:53:34<00:00,  1.71it/s, loss=0.177]

======================================================================
Epoch:    6,
Epoch 6: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:26:30<00:00,  4.16it/s, loss=0.142]
Total time: 8790s, loss: 0.1372
Epoch 6: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:26:30<00:00,  4.16it/s, loss=0.142]

======================================================================
Epoch:    7,
Epoch 7: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:21:49<00:00,  4.30it/s, loss=0.143]
Total time: 8509s, loss: 0.1352
Epoch 7: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:21:49<00:00,  4.30it/s, loss=0.143]

======================================================================
Epoch:    8,
Epoch 8:  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                 | 36551/42365 [2:19:18<22:09,  4.37it/s, loss=0.127]
Training time: 8358s
Epoch 8: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:48:43<00:00,  1.73it/s, loss=0.127]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [2:14:44<00:00,  2.78s/it]

           mrr  hit@1  hit@3  hit@10
tail  0.090915  4.54%  8.67%  18.49%
head  0.017828  1.29%  1.69%   2.77%
mean  0.054371  2.92%  5.18%  10.63%

Ellipsis
Validation time: 16165s
Epoch 8: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:48:43<00:00,  1.73it/s, loss=0.127]
Total time: 24554s, loss: 0.1335
Epoch 8: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:49:14<00:00,  1.73it/s, loss=0.127]

======================================================================
Epoch:    9,
Epoch 9: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:20:15<00:00,  4.34it/s, loss=0.127]
Total time: 8415s, loss: 0.1311
Epoch 9: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:20:15<00:00,  4.34it/s, loss=0.127]

======================================================================
Epoch:   10,
Epoch 10: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:19:32<00:00,  4.37it/s, loss=0.134]
Total time: 8372s, loss: 0.1296
Epoch 10: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:19:32<00:00,  4.37it/s, loss=0.134]

======================================================================
Epoch:   11,
Epoch 11:  86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                 | 36551/42365 [2:20:13<22:18,  4.34it/s, loss=0.128]
Training time: 8413s
Epoch 11: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:47:43<00:00,  1.73it/s, loss=0.128]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [2:14:26<00:00,  2.77s/it]

           mrr  hit@1   hit@3  hit@10
tail  0.103129  4.49%  12.02%  21.59%
head  0.018960  1.29%   1.93%   2.82%
mean  0.061045  2.89%   6.98%  12.21%

Ellipsis
Validation time: 16050s
Epoch 11: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:47:43<00:00,  1.73it/s, loss=0.128]
Total time: 24494s, loss: 0.1291
Epoch 11: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:48:14<00:00,  1.73it/s, loss=0.128]

======================================================================
Epoch:   12,
Epoch 12: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:19:45<00:00,  4.36it/s, loss=0.135]
Total time: 8385s, loss: 0.1285
Epoch 12: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:19:45<00:00,  4.36it/s, loss=0.135]

======================================================================
Epoch:   13,
Epoch 13: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:20:02<00:00,  4.35it/s, loss=0.14]
Total time: 8402s, loss: 0.1287
Epoch 13: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 36551/36551 [2:20:02<00:00,  4.35it/s, loss=0.14]

======================================================================
Epoch:   14,
Epoch 14:  86%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                 | 36551/42365 [2:20:06<22:17,  4.35it/s, loss=0.135]
Training time: 8406s
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:46:51<00:00,  1.74it/s, loss=0.135]
Validation DataLoader 1: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2907/2907 [2:13:54<00:00,  2.76s/it]

           mrr  hit@1  hit@3  hit@10
tail  0.075873  4.39%  6.18%  14.07%
head  0.018530  1.29%  1.84%   2.92%
mean  0.047202  2.84%  4.01%   8.50%

Ellipsis
Validation time: 16005s
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:46:51<00:00,  1.74it/s, loss=0.135]
Total time: 24440s, loss: 0.1289
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:47:20<00:00,  1.73it/s, loss=0.135]`Trainer.fit` stopped: `max_epochs=15` reached.
Epoch 14: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 42365/42365 [6:47:20<00:00,  1.73it/s, loss=0.135]
model_path: [./checkpoint/FB15k-237N-ko=mt5-large=1214.224302/FB15k-237N-ko-epoch=002-val_mrr=0.0919.ckpt]
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [5]
Testing DataLoader 1: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3381/3381 [2:23:30<00:00,  2.55s/it]


           mrr   hit@1   hit@3  hit@10
tail  0.145074  10.04%  14.06%  24.71%
head  0.039670   2.84%   3.93%   6.24%
mean  0.092372   6.44%   9.00%  15.48%

======================================================================
Epoch: test
Ellipsis
======================================================================
Testing DataLoader 1: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3381/3381 [2:23:30<00:00,  2.55s/it]
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Runningstage.testing metric      DataLoader 0             DataLoader 1
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
         val_mrr            0.0923720970749855       0.0923720970749855
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
(KG-S2S) dlt@dl012:~/proj/KG-S2S$

