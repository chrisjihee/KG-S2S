(KG-S2S) chrisjihee@dgx-a100:~/proj/KG-S2S$ bash train-NELL.sh
Namespace(batch_size=128, dataset='NELL', dataset_path='./data/processed', decoder='beam_search', diversity_penalty=0.0, epochs=30, eval_tgt_max_length=25, gpu='4', log_text=False, lr=0.0005, model='T5Finetuner', model_dim=768, model_path='', n_ent=68544, n_rel=358, num_beam_groups=1, num_beams=40, num_workers=4, optim='Adam', pretrained_model='t5-base', save_dir='./checkpoint/NELL-2023-12-01 00:47:38.229508', seed=41504, seq_dropout=0.0, skip_n_val_epoch=15, src_descrip_max_length=0, src_max_length=512, temporal=False, tgt_descrip_max_length=0, train_tgt_max_length=512, use_prefix_search=False, use_rel_prompt_emb=True, use_soft_prompt=True, val_batch_size=8, vocab_size=32128)
Global seed set to 41504
tokenizing entities...
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 68544/68544 [00:23<00:00, 2874.66it/s]
datamodule construction done.
GPU available: True, used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
model construction done.
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1,2,3,4,5,6,7]

  | Name                       | Type                               | Params
----------------------------------------------------------------------------------
0 | T5ForConditionalGeneration | ModifiedT5ForConditionalGeneration | 222 M
1 | rel_embed1                 | Embedding                          | 274 K
2 | rel_embed2                 | Embedding                          | 274 K
3 | rel_embed3                 | Embedding                          | 274 K
4 | rel_embed4                 | Embedding                          | 274 K
----------------------------------------------------------------------------------
224 M     Trainable params
0         Non-trainable params
224 M     Total params
896.013   Total estimated model params size (MB)
Training: 0it [00:00, ?it/s]Epoch:    0,
Epoch 0: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2964/2964 [05:35<00:00,  8.82it/s, loss=0.581]
Total time:  335s, loss: 0.6402
--------------------------------------------------
Epoch:    1,
Epoch 1: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2964/2964 [05:35<00:00,  8.84it/s, loss=0.481]
Total time:  335s, loss: 0.5135
--------------------------------------------------
Epoch:    2,
Epoch 2:  92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                   | 2964/3216 [05:36<00:28,  8.81it/s, loss=0.445]
Training time:  336s
Epoch 2: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉ | 3202/3216 [05:37<00:01,  9.48it/s, loss=0.445]Ellipsisng:  85%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                      | 215/252 [00:01<00:00, 206.24it/s]
Validation time:    1s
Epoch 2: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3216/3216 [05:37<00:00,  9.52it/s, loss=0.445]
Total time:  337s, loss: 0.4540
--------------------------------------------------
Epoch:    3,
Epoch 3: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2964/2964 [05:35<00:00,  8.83it/s, loss=0.43]
Total time:  335s, loss: 0.4120
--------------------------------------------------
Epoch:    4,
Epoch 4: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2964/2964 [05:35<00:00,  8.84it/s, loss=0.373]
Total time:  335s, loss: 0.3803
--------------------------------------------------
Epoch:    5,
Epoch 5:  92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                   | 2964/3216 [05:35<00:28,  8.83it/s, loss=0.373]
Training time:  335s
Epoch 5:  99%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋  | 3186/3216 [05:36<00:03,  9.46it/s, loss=0.373]
Ellipsisng: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 252/252 [00:01<00:00, 213.01it/s]
Validation time:    1s
Epoch 5: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3216/3216 [05:37<00:00,  9.54it/s, loss=0.373]
Total time:  337s, loss: 0.3553
--------------------------------------------------
Epoch:    6,
Epoch 6: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2964/2964 [05:36<00:00,  8.80it/s, loss=0.339]
Total time:  336s, loss: 0.3340
--------------------------------------------------
Epoch:    7,
Epoch 7: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2964/2964 [05:34<00:00,  8.86it/s, loss=0.327]
Total time:  334s, loss: 0.3161
--------------------------------------------------
Epoch:    8,
Epoch 8:  92%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                   | 2964/3216 [05:35<00:28,  8.82it/s, loss=0.312]
Training time:  335s
Epoch 8:  99%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋  | 3186/3216 [05:37<00:03,  9.45it/s, loss=0.312]Ellipsisng:  86%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                    | 216/252 [00:01<00:00, 221.93it/s]
Validation time:    1s
Epoch 8: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3216/3216 [05:37<00:00,  9.54it/s, loss=0.312]
Total time:  337s, loss: 0.3009
--------------------------------------------------
Epoch:    9,
Epoch 9: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2964/2964 [05:35<00:00,  8.84it/s, loss=0.28]
Total time:  335s, loss: 0.2877
--------------------------------------------------
Epoch:   10,
Epoch 10: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2964/2964 [05:34<00:00,  8.86it/s, loss=0.273]
Total time:  334s, loss: 0.2767
--------------------------------------------------
Epoch:   11,
Epoch 11:  92%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                   | 2964/3216 [05:35<00:28,  8.83it/s, loss=0.267]
Training time:  335s
Epoch 11:  99%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋  | 3186/3216 [05:36<00:03,  9.46it/s, loss=0.267]
Ellipsisng: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 252/252 [00:01<00:00, 218.88it/s]
Validation time:    1s
Epoch 11: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3216/3216 [05:36<00:00,  9.55it/s, loss=0.267]
Total time:  336s, loss: 0.2662
--------------------------------------------------
Epoch:   12,
Epoch 12: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2964/2964 [05:35<00:00,  8.84it/s, loss=0.261]
Total time:  335s, loss: 0.2575
--------------------------------------------------
Epoch:   13,
Epoch 13: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2964/2964 [05:34<00:00,  8.86it/s, loss=0.262]
Total time:  334s, loss: 0.2508
--------------------------------------------------
Epoch:   14,
Epoch 14:  92%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                   | 2964/3216 [05:36<00:28,  8.81it/s, loss=0.269]
Training time:  336s
Epoch 14:  99%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋  | 3186/3216 [05:37<00:03,  9.43it/s, loss=0.269]
Ellipsisng: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 252/252 [00:01<00:00, 209.43it/s]
Validation time:    1s
Epoch 14: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3216/3216 [05:37<00:00,  9.52it/s, loss=0.269]
Total time:  337s, loss: 0.2467
--------------------------------------------------
Epoch:   15,
Epoch 15: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2964/2964 [05:36<00:00,  8.81it/s, loss=0.253]
Total time:  336s, loss: 0.2389
--------------------------------------------------
Epoch:   16,
Epoch 16: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2964/2964 [05:34<00:00,  8.85it/s, loss=0.246]
Total time:  334s, loss: 0.2349
--------------------------------------------------
Epoch:   17,
Epoch 17:  92%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                   | 2964/3216 [05:36<00:28,  8.81it/s, loss=0.239]
Training time:  336s
Epoch 17: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3216/3216 [10:22<00:00,  5.17it/s, loss=0.239]
                   mrr            mr   hit@1   hit@3   hit@5  hit@10
tail ranking  0.223343  18930.702191  15.54%  25.40%  30.78%  36.45%
head ranking  0.250474  16822.936255  17.53%  27.69%  34.16%  43.03%
mean ranking  0.236908  17876.819223  16.53%  26.54%  32.47%  39.74%
Ellipsis
Validation time:  286s
Epoch 17: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3216/3216 [10:23<00:00,  5.16it/s, loss=0.239]
Total time:  637s, loss: 0.2292
--------------------------------------------------
Epoch:   18,
Epoch 18: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2964/2964 [05:36<00:00,  8.80it/s, loss=0.236]
Total time:  336s, loss: 0.2254
--------------------------------------------------
Epoch:   19,
Epoch 19: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2964/2964 [05:37<00:00,  8.77it/s, loss=0.23]
Total time:  337s, loss: 0.2212
--------------------------------------------------
Epoch:   20,
Epoch 20:  92%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                   | 2964/3216 [05:37<00:28,  8.78it/s, loss=0.223]
Training time:  337s
Epoch 20: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3216/3216 [10:17<00:00,  5.21it/s, loss=0.223]
                   mrr            mr   hit@1   hit@3   hit@5  hit@10
tail ranking  0.228206  18620.038845  16.24%  25.00%  31.77%  37.85%
head ranking  0.256964  17057.201195  17.93%  29.78%  36.16%  43.53%
mean ranking  0.242585  17838.620020  17.08%  27.39%  33.96%  40.69%
Ellipsis
Validation time:  280s
Epoch 20: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3216/3216 [10:18<00:00,  5.20it/s, loss=0.223]
Total time:  632s, loss: 0.2180
--------------------------------------------------
Epoch:   21,
Epoch 21: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2964/2964 [05:39<00:00,  8.73it/s, loss=0.229]
Total time:  339s, loss: 0.2142
--------------------------------------------------
Epoch:   22,
Epoch 22: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2964/2964 [05:36<00:00,  8.81it/s, loss=0.212]
Total time:  336s, loss: 0.2116
--------------------------------------------------
Epoch:   23,
Epoch 23:  92%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                   | 2964/3216 [05:36<00:28,  8.80it/s, loss=0.215]
Training time:  336s
Epoch 23: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3216/3216 [10:20<00:00,  5.19it/s, loss=0.215]
                   mrr            mr   hit@1   hit@3   hit@5  hit@10
tail ranking  0.223716  18930.467131  16.43%  23.90%  28.98%  36.45%
head ranking  0.256024  16376.881474  18.33%  28.69%  33.27%  42.23%
mean ranking  0.239870  17653.674303  17.38%  26.29%  31.13%  39.34%
Ellipsis
Validation time:  283s
Epoch 23: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3216/3216 [10:20<00:00,  5.18it/s, loss=0.215]
Total time:  620s, loss: 0.2087
--------------------------------------------------
Epoch:   24,
Epoch 24: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2964/2964 [05:34<00:00,  8.86it/s, loss=0.23]
Total time:  334s, loss: 0.2069
--------------------------------------------------
Epoch:   25,
Epoch 25: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2964/2964 [05:36<00:00,  8.81it/s, loss=0.227]
Total time:  336s, loss: 0.2043
--------------------------------------------------
Epoch:   26,
Epoch 26:  92%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                   | 2964/3216 [05:34<00:28,  8.86it/s, loss=0.205]
Training time:  334s
Epoch 26: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3216/3216 [10:13<00:00,  5.24it/s, loss=0.205]
                   mrr            mr   hit@1   hit@3   hit@5  hit@10
tail ranking  0.236688  16687.411355  16.73%  26.49%  31.57%  37.85%
head ranking  0.260088  16256.159363  17.93%  29.28%  34.46%  43.23%
mean ranking  0.248388  16471.785359  17.33%  27.89%  33.02%  40.54%
Ellipsis
Validation time:  280s
Epoch 26: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3216/3216 [10:14<00:00,  5.23it/s, loss=0.205]
Total time:  629s, loss: 0.2022
--------------------------------------------------
Epoch:   27,
Epoch 27: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2964/2964 [05:34<00:00,  8.87it/s, loss=0.204]
Total time:  334s, loss: 0.2004
--------------------------------------------------
Epoch:   28,
Epoch 28: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2964/2964 [05:36<00:00,  8.81it/s, loss=0.202]
Total time:  336s, loss: 0.1983
--------------------------------------------------
Epoch:   29,
Epoch 29:  92%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                   | 2964/3216 [05:36<00:28,  8.81it/s, loss=0.206]
Training time:  336s
Epoch 29: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3216/3216 [10:21<00:00,  5.18it/s, loss=0.206]
                   mrr            mr   hit@1   hit@3   hit@5  hit@10
tail ranking  0.232422  18148.758964  16.63%  26.10%  31.57%  36.75%
head ranking  0.275907  16840.710159  19.42%  32.07%  36.95%  43.82%
mean ranking  0.254165  17494.734562  18.03%  29.08%  34.26%  40.29%
Ellipsis
Validation time:  285s
Epoch 29: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3216/3216 [10:22<00:00,  5.17it/s, loss=0.206]
Total time:  622s, loss: 0.1963
--------------------------------------------------
Epoch 29: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3216/3216 [10:22<00:00,  5.17it/s, loss=0.206]
model_path: /raid/chrisjihee/proj/KG-S2S/checkpoint/NELL-2023-12-01 00:47:38.229508/NELL-epoch=026-val_mrr=0.2367.ckpt
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1,2,3,4,5,6,7]
Testing: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 540/540 [10:09<00:00,  1.02s/it]
                   mrr            mr   hit@1   hit@3   hit@5  hit@10
tail ranking  0.291198  15736.494439  22.01%  32.81%  37.03%  42.91%
head ranking  0.308697  12497.594069  22.57%  33.36%  40.41%  48.93%
mean ranking  0.299948  14117.044254  22.29%  33.09%  38.72%  45.92%
--------------------------------------------------------------------------------
DATALOADER:0 TEST RESULTS
{'val_mrr': 0.29119789600372314}
--------------------------------------------------------------------------------
DATALOADER:1 TEST RESULTS
{'val_mrr': 0.29119789600372314}
--------------------------------------------------------------------------------

==================================================
Epoch: test
Ellipsis
==================================================
Testing: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 540/540 [10:09<00:00,  1.13s/it]
(KG-S2S) chrisjihee@dgx-a100:~/proj/KG-S2S$

